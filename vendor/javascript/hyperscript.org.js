// hyperscript.org@0.9.14 downloaded from https://ga.jspm.io/npm:hyperscript.org@0.9.14/dist/_hyperscript.min.js

var e=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var O={};(function(e,F){const P=F(e);if(typeof O.nodeName!=="string")O=P;else{e._hyperscript=P;"document"in e&&e._hyperscript.browserInit()}})(typeof self!=="undefined"?self:O,(O=>{const F={dynamicResolvers:[function(e,O){if(e==="Fixed")return Number(O).toFixed();if(e.indexOf("Fixed:")===0){let F=e.split(":")[1];return Number(O).toFixed(parseInt(F))}}],String:function(e){return e.toString?e.toString():""+e},Int:function(e){return parseInt(e)},Float:function(e){return parseFloat(e)},Number:function(e){return Number(e)},Date:function(e){return new Date(e)},Array:function(e){return Array.from(e)},JSON:function(e){return JSON.stringify(e)},Object:function(e){e instanceof String&&(e=e.toString());return typeof e==="string"?JSON.parse(e):Object.assign({},e)}};const P={attributes:"_, script, data-script",defaultTransition:"all 500ms ease-in",disableSelector:"[disable-scripting], [data-disable-scripting]",hideShowStrategies:{},conversions:F};class n{static OP_TABLE={"+":"PLUS","-":"MINUS","*":"MULTIPLY","/":"DIVIDE",".":"PERIOD","..":"ELLIPSIS","\\":"BACKSLASH",":":"COLON","%":"PERCENT","|":"PIPE","!":"EXCLAMATION","?":"QUESTION","#":"POUND","&":"AMPERSAND",$:"DOLLAR",";":"SEMI",",":"COMMA","(":"L_PAREN",")":"R_PAREN","<":"L_ANG",">":"R_ANG","<=":"LTE_ANG",">=":"GTE_ANG","==":"EQ","===":"EQQ","!=":"NEQ","!==":"NEQQ","{":"L_BRACE","}":"R_BRACE","[":"L_BRACKET","]":"R_BRACKET","=":"EQUALS","~":"TILDE"};static isValidCSSClassChar(e){return n.isAlpha(e)||n.isNumeric(e)||e==="-"||e==="_"||e===":"}static isValidCSSIDChar(e){return n.isAlpha(e)||n.isNumeric(e)||e==="-"||e==="_"||e===":"}static isWhitespace(e){return e===" "||e==="\t"||n.isNewline(e)}static positionString(e){return"[Line: "+e.line+", Column: "+e.column+"]"}static isNewline(e){return e==="\r"||e==="\n"}static isNumeric(e){return e>="0"&&e<="9"}static isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}static isIdentifierChar(e,O){return e==="_"||e==="$"}static isReservedChar(e){return e==="`"||e==="^"}static isValidSingleQuoteStringStart(e){if(e.length>0){var O=e[e.length-1];if(O.type==="IDENTIFIER"||O.type==="CLASS_REF"||O.type==="ID_REF")return false;if(O.op&&(O.value===">"||O.value===")"))return false}return true}static tokenize(e,O){var F=[];var P=e;var M=0;var D=0;var _=1;var G="<START>";var H=0;function f(){return O&&H===0}while(M<P.length)if(q()==="-"&&I()==="-"&&(n.isWhitespace(C(2))||C(2)===""||C(2)==="-")||q()==="/"&&I()==="/"&&(n.isWhitespace(C(2))||C(2)===""||C(2)==="/"))h();else if(q()!=="/"||I()!=="*"||!n.isWhitespace(C(2))&&C(2)!==""&&C(2)!=="*")if(n.isWhitespace(q()))F.push(L());else if(A()||q()!=="."||!n.isAlpha(I())&&I()!=="{"&&I()!=="-")if(A()||q()!=="#"||!n.isAlpha(I())&&I()!=="{")if(q()==="["&&I()==="@")F.push(E());else if(q()==="@")F.push(T());else if(q()==="*"&&n.isAlpha(I()))F.push(y());else if(f()&&(n.isAlpha(q())||q()==="\\"))F.push(x());else if(f()||!n.isAlpha(q())&&!n.isIdentifierChar(q()))if(n.isNumeric(q()))F.push(b());else if(f()||q()!=='"'&&q()!=="`")if(f()||q()!=="'"){if(n.OP_TABLE[q()]){G==="$"&&q()==="{"&&H++;q()==="}"&&H--;F.push(w())}else if(f()||n.isReservedChar(q()))F.push(p("RESERVED",R()));else if(M<P.length)throw Error("Unknown token: "+q()+" ")}else n.isValidSingleQuoteStringStart(F)?F.push(S()):F.push(w());else F.push(S());else F.push(g());else F.push(k());else F.push(d());else v();return new i(F,[],P);function m(e,O){var F=p(e,O);F.op=true;return F}function p(e,O){return{type:e,value:O||"",start:M,end:M+1,column:D,line:_}}function h(){while(q()&&!n.isNewline(q()))R();R()}function v(){while(q()&&!(q()==="*"&&I()==="/"))R();R();R()}function d(){var e=p("CLASS_REF");var O=R();if(q()==="{"){e.template=true;O+=R();while(q()&&q()!=="}")O+=R();if(q()!=="}")throw Error("Unterminated class reference");O+=R()}else while(n.isValidCSSClassChar(q())||q()==="\\"){q()==="\\"&&R();O+=R()}e.value=O;e.end=M;return e}function E(){var e=p("ATTRIBUTE_REF");var O=R();while(M<P.length&&q()!=="]")O+=R();q()==="]"&&(O+=R());e.value=O;e.end=M;return e}function T(){var e=p("ATTRIBUTE_REF");var O=R();while(n.isValidCSSIDChar(q()))O+=R();if(q()==="="){O+=R();if(q()==='"'||q()==="'"){let e=S();O+=e.value}else if(n.isAlpha(q())||n.isNumeric(q())||n.isIdentifierChar(q())){let e=g();O+=e.value}}e.value=O;e.end=M;return e}function y(){var e=p("STYLE_REF");var O=R();while(n.isAlpha(q())||q()==="-")O+=R();e.value=O;e.end=M;return e}function k(){var e=p("ID_REF");var O=R();if(q()==="{"){e.template=true;O+=R();while(q()&&q()!=="}")O+=R();if(q()!=="}")throw Error("Unterminated id reference");R()}else while(n.isValidCSSIDChar(q()))O+=R();e.value=O;e.end=M;return e}function x(){var e=p("IDENTIFIER");var O=R();var F=O==="\\";F&&(O="");while(n.isAlpha(q())||n.isNumeric(q())||n.isIdentifierChar(q())||q()==="\\"||q()==="{"||q()==="}"){if(q()==="$"&&F===false)break;if(q()==="\\"){F=true;R()}else{F=false;O+=R()}}q()==="!"&&O==="beep"&&(O+=R());e.value=O;e.end=M;return e}function g(){var e=p("IDENTIFIER");var O=R();while(n.isAlpha(q())||n.isNumeric(q())||n.isIdentifierChar(q()))O+=R();q()==="!"&&O==="beep"&&(O+=R());e.value=O;e.end=M;return e}function b(){var e=p("NUMBER");var O=R();while(n.isNumeric(q()))O+=R();q()==="."&&n.isNumeric(I())&&(O+=R());while(n.isNumeric(q()))O+=R();if(q()==="e"||q()==="E")if(n.isNumeric(I()))O+=R();else if(I()==="-"){O+=R();O+=R()}while(n.isNumeric(q()))O+=R();e.value=O;e.end=M;return e}function w(){var e=m();var O=R();while(q()&&n.OP_TABLE[O+q()])O+=R();e.type=n.OP_TABLE[O];e.value=O;e.end=M;return e}function S(){var e=p("STRING");var O=R();e.template=O==="`";var F="";while(q()&&q()!==O)if(q()==="\\"){R();let O=R();if(O==="b")F+="\b";else if(O==="f")F+="\f";else if(O==="n")F+="\n";else if(O==="r")F+="\r";else if(O==="t")F+="\t";else if(O==="v")F+="\v";else if(e.template&&O==="$")F+="\\$";else if(O==="x"){const O=N();if(Number.isNaN(O))throw Error("Invalid hexadecimal escape at "+n.positionString(e));F+=String.fromCharCode(O)}else F+=O}else F+=R();if(q()!==O)throw Error("Unterminated string at "+n.positionString(e));R();e.value=F;e.end=M;return e}function N(){const e=16;if(!q())return NaN;let O=e*Number.parseInt(R(),e);if(!q())return NaN;O+=Number.parseInt(R(),e);return O}function q(){return P.charAt(M)}function I(){return P.charAt(M+1)}function C(e=1){return P.charAt(M+e)}function R(){G=q();M++;D++;return G}function A(){return n.isAlpha(G)||n.isNumeric(G)||G===")"||G==='"'||G==="'"||G==="`"||G==="}"||G==="]"}function L(){var e=p("WHITESPACE");var O="";while(q()&&n.isWhitespace(q())){if(n.isNewline(q())){D=0;_++}O+=R()}e.value=O;e.end=M;return e}}tokenize(e,O){return n.tokenize(e,O)}}class i{constructor(e,O,F){this.tokens=e;this.consumed=O;this.source=F;this.consumeWhitespace()}get list(){return this.tokens}_lastConsumed=null;consumeWhitespace(){while(this.token(0,true).type==="WHITESPACE")this.consumed.push(this.tokens.shift())}raiseError(e,O){a.raiseParseError(e,O)}requireOpToken(e){var O=this.matchOpToken(e);if(O)return O;this.raiseError(this,"Expected '"+e+"' but found '"+this.currentToken().value+"'")}matchAnyOpToken(e,O,F){for(var P=0;P<arguments.length;P++){var M=arguments[P];var D=this.matchOpToken(M);if(D)return D}}matchAnyToken(e,O,F){for(var P=0;P<arguments.length;P++){var M=arguments[P];var D=this.matchToken(M);if(D)return D}}matchOpToken(e){if(this.currentToken()&&this.currentToken().op&&this.currentToken().value===e)return this.consumeToken()}requireTokenType(e,O,F,P){var M=this.matchTokenType(e,O,F,P);if(M)return M;this.raiseError(this,"Expected one of "+JSON.stringify([e,O,F]))}matchTokenType(e,O,F,P){if(this.currentToken()&&this.currentToken().type&&[e,O,F,P].indexOf(this.currentToken().type)>=0)return this.consumeToken()}requireToken(e,O){var F=this.matchToken(e,O);if(F)return F;this.raiseError(this,"Expected '"+e+"' but found '"+this.currentToken().value+"'")}peekToken(e,O,F){O=O||0;F=F||"IDENTIFIER";if(this.tokens[O]&&this.tokens[O].value===e&&this.tokens[O].type===F)return this.tokens[O]}matchToken(e,O){if(this.follows.indexOf(e)===-1){O=O||"IDENTIFIER";return this.currentToken()&&this.currentToken().value===e&&this.currentToken().type===O?this.consumeToken():void 0}}consumeToken(){var e=this.tokens.shift();this.consumed.push(e);this._lastConsumed=e;this.consumeWhitespace();return e}consumeUntil(e,O){var F=[];var P=this.token(0,true);while((O==null||P.type!==O)&&(e==null||P.value!==e)&&P.type!=="EOF"){var M=this.tokens.shift();this.consumed.push(M);F.push(P);P=this.token(0,true)}this.consumeWhitespace();return F}lastWhitespace(){return this.consumed[this.consumed.length-1]&&this.consumed[this.consumed.length-1].type==="WHITESPACE"?this.consumed[this.consumed.length-1].value:""}consumeUntilWhitespace(){return this.consumeUntil(null,"WHITESPACE")}hasMore(){return this.tokens.length>0}token(e,O){var F;var P=0;do{if(!O)while(this.tokens[P]&&this.tokens[P].type==="WHITESPACE")P++;F=this.tokens[P];e--;P++}while(e>-1);return F||{type:"EOF",value:"<<<EOF>>>"}}currentToken(){return this.token(0)}lastMatch(){return this._lastConsumed}static sourceFor=function(){return this.programSource.substring(this.startToken.start,this.endToken.end)};static lineFor=function(){return this.programSource.split("\n")[this.startToken.line-1]};follows=[];pushFollow(e){this.follows.push(e)}popFollow(){this.follows.pop()}clearFollows(){var e=this.follows;this.follows=[];return e}restoreFollows(e){this.follows=e}}class a{constructor(e){this.runtime=e;this.possessivesDisabled=false;this.addGrammarElement("feature",(function(e,O,F){if(F.matchOpToken("(")){var P=e.requireElement("feature",F);F.requireOpToken(")");return P}var M=e.FEATURES[F.currentToken().value||""];if(M)return M(e,O,F)}));this.addGrammarElement("command",(function(e,O,F){if(F.matchOpToken("(")){const O=e.requireElement("command",F);F.requireOpToken(")");return O}var P=e.COMMANDS[F.currentToken().value||""];let M;P?M=P(e,O,F):F.currentToken().type==="IDENTIFIER"&&(M=e.parseElement("pseudoCommand",F));return M?e.parseElement("indirectStatement",F,M):M}));this.addGrammarElement("commandList",(function(e,O,F){if(F.hasMore()){var P=e.parseElement("command",F);if(P){F.matchToken("then");const O=e.parseElement("commandList",F);O&&(P.next=O);return P}}return{type:"emptyCommandListCommand",op:function(e){return O.findNext(this,e)},execute:function(e){return O.unifiedExec(this,e)}}}));this.addGrammarElement("leaf",(function(e,O,F){var P=e.parseAnyOf(e.LEAF_EXPRESSIONS,F);return P==null?e.parseElement("symbol",F):P}));this.addGrammarElement("indirectExpression",(function(e,O,F,P){for(var M=0;M<e.INDIRECT_EXPRESSIONS.length;M++){var D=e.INDIRECT_EXPRESSIONS[M];P.endToken=F.lastMatch();var _=e.parseElement(D,F,P);if(_)return _}return P}));this.addGrammarElement("indirectStatement",(function(e,O,F,P){if(F.matchToken("unless")){P.endToken=F.lastMatch();var M=e.requireElement("expression",F);var D={type:"unlessStatementModifier",args:[M],op:function(e,O){return O?this.next:P},execute:function(e){return O.unifiedExec(this,e)}};P.parent=D;return D}return P}));this.addGrammarElement("primaryExpression",(function(e,O,F){var P=e.parseElement("leaf",F);if(P)return e.parseElement("indirectExpression",F,P);e.raiseParseError(F,"Unexpected value: "+F.currentToken().value)}))}use(e){e(this);return this}GRAMMAR={};COMMANDS={};FEATURES={};LEAF_EXPRESSIONS=[];INDIRECT_EXPRESSIONS=[];initElt(e,O,F){e.startToken=O;e.sourceFor=i.sourceFor;e.lineFor=i.lineFor;e.programSource=F.source}parseElement(e,O,F=void 0){var P=this.GRAMMAR[e];if(P){var M=O.currentToken();var D=P(this,this.runtime,O,F);if(D){this.initElt(D,M,O);D.endToken=D.endToken||O.lastMatch();F=D.root;while(F!=null){this.initElt(F,M,O);F=F.root}}return D}}requireElement(e,O,F,P){var M=this.parseElement(e,O,P);M||a.raiseParseError(O,F||"Expected "+e);return M}parseAnyOf(e,O){for(var F=0;F<e.length;F++){var P=e[F];var M=this.parseElement(P,O);if(M)return M}}addGrammarElement(e,O){this.GRAMMAR[e]=O}addCommand(e,O){var F=e+"Command";var n=function(e,P,M){const D=O(e,P,M);if(D){D.type=F;D.execute=function(e){e.meta.command=D;return P.unifiedExec(this,e)};return D}};this.GRAMMAR[F]=n;this.COMMANDS[e]=n}addFeature(e,O){var F=e+"Feature";var n=function(P,M,D){var _=O(P,M,D);if(_){_.isFeature=true;_.keyword=e;_.type=F;return _}};this.GRAMMAR[F]=n;this.FEATURES[e]=n}addLeafExpression(e,O){this.LEAF_EXPRESSIONS.push(e);this.addGrammarElement(e,O)}addIndirectExpression(e,O){this.INDIRECT_EXPRESSIONS.push(e);this.addGrammarElement(e,O)}static createParserContext(e){var O=e.currentToken();var F=e.source;var P=F.split("\n");var M=O&&O.line?O.line-1:P.length-1;var D=P[M];var _=O&&O.line?O.column:D.length-1;return D+"\n"+" ".repeat(_)+"^^\n\n"}static raiseParseError(e,O){O=(O||"Unexpected Token : "+e.currentToken().value)+"\n\n"+a.createParserContext(e);var F=new Error(O);F.tokens=e;throw F}raiseParseError(e,O){a.raiseParseError(e,O)}parseHyperScript(e){var O=this.parseElement("hyperscript",e);e.hasMore()&&this.raiseParseError(e);if(O)return O}setParent(e,O){if(typeof e==="object"){e.parent=O;if(typeof O==="object"){O.children=O.children||new Set;O.children.add(e)}this.setParent(e.next,O)}}commandStart(e){return this.COMMANDS[e.value||""]}featureStart(e){return this.FEATURES[e.value||""]}commandBoundary(e){return!(e.value!="end"&&e.value!="then"&&e.value!="else"&&e.value!="otherwise"&&e.value!=")"&&!this.commandStart(e)&&!this.featureStart(e)&&e.type!="EOF")}parseStringTemplate(e){var O=[""];do{O.push(e.lastWhitespace());if(e.currentToken().value==="$"){e.consumeToken();var F=e.matchOpToken("{");O.push(this.requireElement("expression",e));F&&e.requireOpToken("}");O.push("")}else if(e.currentToken().value==="\\"){e.consumeToken();e.consumeToken()}else{var P=e.consumeToken();O[O.length-1]+=P?P.value:""}}while(e.hasMore());O.push(e.lastWhitespace());return O}ensureTerminated(e){const O=this.runtime;var F={type:"implicitReturn",op:function(e){e.meta.returned=true;e.meta.resolve&&e.meta.resolve();return O.HALT},execute:function(e){}};var P=e;while(P.next)P=P.next;P.next=F}}class o{constructor(e,O){this.lexer=e??new n;this.parser=O??new a(this).use(T).use(y);this.parser.runtime=this}matchesSelector(e,O){var F=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return F&&F.call(e,O)}makeEvent(e,F){var P;if(O.Event&&typeof O.Event==="function"){P=new Event(e,{bubbles:true,cancelable:true,composed:true});P.detail=F}else{P=document.createEvent("CustomEvent");P.initCustomEvent(e,true,true,F)}return P}triggerEvent(e,O,F,P){F=F||{};F.sender=P;var M=this.makeEvent(O,F);var D=e.dispatchEvent(M);return D}isArrayLike(e){return Array.isArray(e)||typeof NodeList!=="undefined"&&(e instanceof NodeList||e instanceof HTMLCollection||e instanceof FileList)}isIterable(e){return typeof e==="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]==="function"}shouldAutoIterate(e){return e!=null&&e[D]||this.isArrayLike(e)}forEach(e,O){if(e==null);else if(this.isIterable(e))for(const F of e)O(F);else if(this.isArrayLike(e))for(var F=0;F<e.length;F++)O(e[F]);else O(e)}implicitLoop(e,O){if(this.shouldAutoIterate(e))for(const F of e)O(F);else O(e)}wrapArrays(e){var O=[];for(var F=0;F<e.length;F++){var P=e[F];Array.isArray(P)?O.push(Promise.all(P)):O.push(P)}return O}unwrapAsyncs(e){for(var O=0;O<e.length;O++){var F=e[O];F.asyncWrapper&&(e[O]=F.value);if(Array.isArray(F))for(var P=0;P<F.length;P++){var M=F[P];M.asyncWrapper&&(F[P]=M.value)}}}static HALT={};HALT=o.HALT;unifiedExec(e,O){while(true){try{var F=this.unifiedEval(e,O)}catch(P){if(O.meta.handlingFinally){console.error(" Exception in finally block: ",P);F=o.HALT}else{this.registerHyperTrace(O,P);if(O.meta.errorHandler&&!O.meta.handlingError){O.meta.handlingError=true;O.locals[O.meta.errorSymbol]=P;e=O.meta.errorHandler;continue}O.meta.currentException=P;F=o.HALT}}if(F==null){console.error(e," did not return a next element to execute! context: ",O);return}if(F.then){F.then((e=>{this.unifiedExec(e,O)})).catch((e=>{this.unifiedExec({op:function(){throw e}},O)}));return}if(F===o.HALT){if(!O.meta.finallyHandler||O.meta.handlingFinally){O.meta.onHalt&&O.meta.onHalt();if(O.meta.currentException){if(O.meta.reject){O.meta.reject(O.meta.currentException);return}throw O.meta.currentException}return}O.meta.handlingFinally=true;e=O.meta.finallyHandler}else e=F}}unifiedEval(e,O,F){var P=[O];var M=false;var D=false;if(e.args)for(var _=0;_<e.args.length;_++){var G=e.args[_];if(G==null)P.push(null);else if(Array.isArray(G)){var H=[];for(var j=0;j<G.length;j++){var U=G[j];var W=U?U.evaluate(O):null;W&&(W.then?M=true:W.asyncWrapper&&(D=true));H.push(W)}P.push(H)}else if(G.evaluate){W=G.evaluate(O);W&&(W.then?M=true:W.asyncWrapper&&(D=true));P.push(W);if(W){if(F===true)break}else if(F===false)break}else P.push(G)}if(M)return new Promise(((O,F)=>{P=this.wrapArrays(P);Promise.all(P).then((function(P){D&&this.unwrapAsyncs(P);try{var M=e.op.apply(e,P);O(M)}catch(e){F(e)}})).catch((function(e){F(e)}))}));D&&this.unwrapAsyncs(P);return e.op.apply(e,P)}_scriptAttrs=null;getScriptAttributes(){this._scriptAttrs==null&&(this._scriptAttrs=P.attributes.replace(/ /g,"").split(","));return this._scriptAttrs}getScript(e){for(var O=0;O<this.getScriptAttributes().length;O++){var F=this.getScriptAttributes()[O];if(e.hasAttribute&&e.hasAttribute(F))return e.getAttribute(F)}return e instanceof HTMLScriptElement&&e.type==="text/hyperscript"?e.innerText:null}hyperscriptFeaturesMap=new WeakMap;getHyperscriptFeatures(e){var O=this.hyperscriptFeaturesMap.get(e);typeof O==="undefined"&&e&&this.hyperscriptFeaturesMap.set(e,O={});return O}addFeatures(e,O){if(e){Object.assign(O.locals,this.getHyperscriptFeatures(e));this.addFeatures(e.parentElement,O)}}makeContext(e,O,F,P){return new f(e,O,F,P,this)}getScriptSelector(){return this.getScriptAttributes().map((function(e){return"["+e+"]"})).join(", ")}convertValue(e,O){var P=F.dynamicResolvers;for(var M=0;M<P.length;M++){var D=P[M];var _=D(O,e);if(_!==void 0)return _}if(e==null)return null;var G=F[O];if(G)return G(e);throw"Unknown conversion : "+O}parse(e){const O=this.lexer,F=this.parser;var P=O.tokenize(e);if(this.parser.commandStart(P.currentToken())){var M=F.requireElement("commandList",P);P.hasMore()&&F.raiseParseError(P);F.ensureTerminated(M);return M}if(F.featureStart(P.currentToken())){var D=F.requireElement("hyperscript",P);P.hasMore()&&F.raiseParseError(P);return D}var _=F.requireElement("expression",P);P.hasMore()&&F.raiseParseError(P);return _}evaluateNoPromise(e,O){let F=e.evaluate(O);if(F.next)throw new Error(i.sourceFor.call(e)+" returned a Promise in a context that they are not allowed.");return F}evaluate(e,F,P){class i extends EventTarget{constructor(e){super();this.module=e}toString(){return this.module.id}}var M="document"in O?O.document.body:new i(P&&P.module);F=Object.assign(this.makeContext(M,null,M,null),F||{});var D=this.parse(e);if(D.execute){D.execute(F);return typeof F.meta.returnValue!=="undefined"?F.meta.returnValue:F.result}if(D.apply){D.apply(M,M,P);return this.getHyperscriptFeatures(M)}return D.evaluate(F)}processNode(e){var O=this.getScriptSelector();this.matchesSelector(e,O)&&this.initElement(e,e);e instanceof HTMLScriptElement&&e.type==="text/hyperscript"&&this.initElement(e,document.body);e.querySelectorAll&&this.forEach(e.querySelectorAll(O+", [type='text/hyperscript']"),(e=>{this.initElement(e,e instanceof HTMLScriptElement&&e.type==="text/hyperscript"?document.body:e)}))}initElement(e,O){if(!e.closest||!e.closest(P.disableSelector)){var F=this.getInternalData(e);if(!F.initialized){var M=this.getScript(e);if(M)try{F.initialized=true;F.script=M;const P=this.lexer,G=this.parser;var D=P.tokenize(M);var _=G.parseHyperScript(D);if(!_)return;_.apply(O||e,e);setTimeout((()=>{this.triggerEvent(O||e,"load",{hyperscript:true})}),1)}catch(O){this.triggerEvent(e,"exception",{error:O});console.error("hyperscript errors were found on the following element:",e,"\n\n",O.message,O.stack)}}}}internalDataMap=new WeakMap;getInternalData(e){var O=this.internalDataMap.get(e);typeof O==="undefined"&&this.internalDataMap.set(e,O={});return O}typeCheck(e,O,F){if(e==null&&F)return true;var P=Object.prototype.toString.call(e).slice(8,-1);return P===O}getElementScope(e){var O=e.meta&&e.meta.owner;if(O){var F=this.getInternalData(O);var P="elementScope";e.meta.feature&&e.meta.feature.behavior&&(P=e.meta.feature.behavior+"Scope");var M=h(F,P);return M}return{}}isReservedWord(e){return["meta","it","result","locals","event","target","detail","sender","body"].includes(e)}isHyperscriptContext(e){return e instanceof f}resolveSymbol(e,F,P){if(e==="me"||e==="my"||e==="I")return F.me;if(e==="it"||e==="its"||e==="result")return F.result;if(e==="you"||e==="your"||e==="yourself")return F.you;if(P==="global")return O[e];if(P==="element"){var M=this.getElementScope(F);return M[e]}if(P==="local")return F.locals[e];if(F.meta&&F.meta.context){var D=F.meta.context[e];if(typeof D!=="undefined")return D;if(F.meta.context.detail){D=F.meta.context.detail[e];if(typeof D!=="undefined")return D}}if(this.isHyperscriptContext(F)&&!this.isReservedWord(e))var _=F.locals[e];else _=F[e];if(typeof _!=="undefined")return _;M=this.getElementScope(F);_=M[e];return typeof _!=="undefined"?_:O[e]}setSymbol(e,F,P,M){if(P==="global")O[e]=M;else if(P==="element"){var D=this.getElementScope(F);D[e]=M}else if(P==="local")F.locals[e]=M;else if(this.isHyperscriptContext(F)&&!this.isReservedWord(e)&&typeof F.locals[e]!=="undefined")F.locals[e]=M;else{D=this.getElementScope(F);var _=D[e];typeof _!=="undefined"?D[e]=M:this.isHyperscriptContext(F)&&!this.isReservedWord(e)?F.locals[e]=M:F[e]=M}}findNext(e,O){if(e)return e.resolveNext?e.resolveNext(O):e.next?e.next:this.findNext(e.parent,O)}flatGet(e,O,F){if(e!=null){var P=F(e,O);if(typeof P!=="undefined")return P;if(this.shouldAutoIterate(e)){var M=[];for(var D of e){var _=F(D,O);M.push(_)}return M}}}resolveProperty(e,O){return this.flatGet(e,O,((e,O)=>e[O]))}resolveAttribute(e,O){return this.flatGet(e,O,((e,O)=>e.getAttribute&&e.getAttribute(O)))}resolveStyle(e,O){return this.flatGet(e,O,((e,O)=>e.style&&e.style[O]))}resolveComputedStyle(e,O){return this.flatGet(e,O,((e,O)=>getComputedStyle(e).getPropertyValue(O)))}assignToNamespace(e,F,P,M){let D;D=typeof document!=="undefined"&&e===document.body?O:this.getHyperscriptFeatures(e);var _;while((_=F.shift())!==void 0){var G=D[_];if(G==null){G={};D[_]=G}D=G}D[P]=M}getHyperTrace(e,O){var F=[];var P=e;while(P.meta.caller)P=P.meta.caller;if(P.meta.traceMap)return P.meta.traceMap.get(O,F)}registerHyperTrace(e,O){var F=[];var P=null;while(e!=null){F.push(e);P=e;e=e.meta.caller}P.meta.traceMap==null&&(P.meta.traceMap=new Map);if(!P.meta.traceMap.get(O)){var M={trace:F,print:function(e){e=e||console.error;e("hypertrace /// ");var O=0;for(var P=0;P<F.length;P++)O=Math.max(O,F[P].meta.feature.displayName.length);for(P=0;P<F.length;P++){var M=F[P];e("  ->",M.meta.feature.displayName.padEnd(O+2),"-",M.meta.owner)}}};P.meta.traceMap.set(O,M)}}escapeSelector(e){return e.replace(/[:&()\[\]\/]/g,(function(e){return"\\"+e}))}nullCheck(e,O){if(e==null)throw new Error("'"+O.sourceFor()+"' is null")}isEmpty(e){return e==void 0||e.length===0}doesExist(e){if(e==null)return false;if(this.shouldAutoIterate(e)){for(const O of e)return true;return false}return true}getRootNode(e){if(e&&e instanceof Node){var O=e.getRootNode();if(O instanceof Document||O instanceof ShadowRoot)return O}return document}getEventQueueFor(e,O){let F=this.getInternalData(e);var P=F.eventQueues;if(P==null){P=new Map;F.eventQueues=P}var M=P.get(O);if(M==null){M={queue:[],executing:false};P.set(O,M)}return M}beepValueToConsole(e,O,F){if(this.triggerEvent(e,"hyperscript:beep",{element:e,expression:O,value:F})){var P;P=F?F instanceof m?"ElementCollection":F.constructor?F.constructor.name:"unknown":"object (null)";var M=F;P==="String"?M='"'+M+'"':F instanceof m&&(M=Array.from(F));console.log("///_ BEEP! The expression ("+i.sourceFor.call(O).replace("beep! ","")+") evaluates to:",M,"of type "+P)}}hyperscriptUrl="document"in O&&document.currentScript?document.currentScript.src:null}function s(){let e=document.cookie.split("; ").map((e=>{let O=e.split("=");return{name:O[0],value:decodeURIComponent(O[1])}}));return e}function u(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}function l(){for(const e of s())u(e.name)}const M=new Proxy({},{get(e,O){if(O==="then"||O==="asyncWrapper")return null;if(O==="length")return s().length;if(O==="clear")return u;if(O==="clearAll")return l;if(typeof O==="string"){if(!isNaN(O))return s()[parseInt(O)];{let e=document.cookie.split("; ").find((e=>e.startsWith(O+"=")))?.split("=")[1];if(e)return decodeURIComponent(e)}}else if(O===Symbol.iterator)return s()[O]},set(e,O,F){var P=null;if("string"===typeof F){P=encodeURIComponent(F);P+=";samesite=lax"}else{P=encodeURIComponent(F.value);F.expires&&(P+=";expires="+F.maxAge);F.maxAge&&(P+=";max-age="+F.maxAge);F.partitioned&&(P+=";partitioned="+F.partitioned);F.path&&(P+=";path="+F.path);F.samesite&&(P+=";samesite="+F.path);F.secure&&(P+=";secure="+F.path)}document.cookie=O+"="+P;return true}});class f{constructor(e,F,P,D,_){this.meta={parser:_.parser,lexer:_.lexer,runtime:_,owner:e,feature:F,iterators:{},ctx:this};this.locals={cookies:M};this.me=P,this.you=void 0;this.result=void 0;this.event=D;this.target=D?D.target:null;this.detail=D?D.detail:null;this.sender=D&&D.detail?D.detail.sender:null;this.body="document"in O?document.body:null;_.addFeatures(e,this)}}class m{constructor(e,O,F){this._css=e;this.relativeToElement=O;this.escape=F;this[D]=true}get css(){return this.escape?o.prototype.escapeSelector(this._css):this._css}get className(){return this._css.substr(1)}get id(){return this.className()}contains(e){for(let O of this)if(O.contains(e))return true;return false}get length(){return this.selectMatches().length}[Symbol.iterator](){let e=this.selectMatches();return e[Symbol.iterator]()}selectMatches(){let e=o.prototype.getRootNode(this.relativeToElement).querySelectorAll(this.css);return e}}const D=Symbol();function h(e,O){var F=e[O];if(F)return F;var P={};e[O]=P;return P}function v(e){try{return JSON.parse(e)}catch(e){d(e);return null}}function d(e){console.error?console.error(e):console.log&&console.log("ERROR: ",e)}function E(e,O){return new(e.bind.apply(e,[e].concat(O)))}function T(F){F.addLeafExpression("parenthesized",(function(e,O,F){if(F.matchOpToken("(")){var P=F.clearFollows();try{var M=e.requireElement("expression",F)}finally{F.restoreFollows(P)}F.requireOpToken(")");return M}}));F.addLeafExpression("string",(function(O,F,P){var M=P.matchTokenType("STRING");if(M){var D=M.value;var _;if(M.template){var G=n.tokenize(D,true);_=O.parseStringTemplate(G)}else _=[];return{type:"string",token:M,args:_,op:function(e){var O="";for(var F=1;F<arguments.length;F++){var P=arguments[F];P!==void 0&&(O+=P)}return O},evaluate:function(O){return _.length===0?D:F.unifiedEval(this||e,O)}}}}));F.addGrammarElement("nakedString",(function(e,O,F){if(F.hasMore()){var P=F.consumeUntilWhitespace();F.matchTokenType("WHITESPACE");return{type:"nakedString",tokens:P,evaluate:function(e){return P.map((function(e){return e.value})).join("")}}}}));F.addLeafExpression("number",(function(e,O,F){var P=F.matchTokenType("NUMBER");if(P){var M=P;var D=parseFloat(P.value);return{type:"number",value:D,numberToken:M,evaluate:function(){return D}}}}));F.addLeafExpression("idRef",(function(O,F,P){var M=P.matchTokenType("ID_REF");if(M&&M.value){if(M.template){var D=M.value.substring(2);var _=n.tokenize(D);var G=O.requireElement("expression",_);return{type:"idRefTemplate",args:[G],op:function(e,O){return F.getRootNode(e.me).getElementById(O)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}{const e=M.value.substring(1);return{type:"idRef",css:M.value,value:e,evaluate:function(O){return F.getRootNode(O.me).getElementById(e)}}}}}));F.addLeafExpression("classRef",(function(O,F,P){var M=P.matchTokenType("CLASS_REF");if(M&&M.value){if(M.template){var D=M.value.substring(2);var _=n.tokenize(D);var G=O.requireElement("expression",_);return{type:"classRefTemplate",args:[G],op:function(e,O){return new m("."+O,e.me,true)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}{const e=M.value;return{type:"classRef",css:e,evaluate:function(O){return new m(e,O.me,true)}}}}}));class r extends m{constructor(e,O,F){super(e,O);this.templateParts=F;this.elements=F.filter((e=>e instanceof Element))}get css(){let e="",O=0;for(const F of this.templateParts)F instanceof Element?e+="[data-hs-query-id='"+O+++"']":e+=F;return e}[Symbol.iterator](){this.elements.forEach(((e,O)=>e.dataset.hsQueryId=O));const e=super[Symbol.iterator]();this.elements.forEach((e=>e.removeAttribute("data-hs-query-id")));return e}}F.addLeafExpression("queryRef",(function(O,F,P){var M=P.matchOpToken("<");if(M){var D=P.consumeUntil("/");P.requireOpToken("/");P.requireOpToken(">");var _=D.map((function(e){return e.type==="STRING"?'"'+e.value+'"':e.value})).join("");var G,H,j;if(/\$[^=]/.test(_)){G=true;H=n.tokenize(_,true);j=O.parseStringTemplate(H)}return{type:"queryRef",css:_,args:j,op:function(e,...O){return G?new r(_,e.me,O):new m(_,e.me)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));F.addLeafExpression("attributeRef",(function(O,F,P){var M=P.matchTokenType("ATTRIBUTE_REF");if(M&&M.value){var D=M.value;if(D.indexOf("[")===0)var _=D.substring(2,D.length-1);else _=D.substring(1);var G="["+_+"]";var H=_.split("=");var j=H[0];var U=H[1];U&&U.indexOf('"')===0&&(U=U.substring(1,U.length-1));return{type:"attributeRef",name:j,css:G,value:U,op:function(e){var O=e.you||e.me;if(O)return O.getAttribute(j)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));F.addLeafExpression("styleRef",(function(O,F,P){var M=P.matchTokenType("STYLE_REF");if(M&&M.value){var D=M.value.substr(1);if(D.startsWith("computed-")){D=D.substr(9);return{type:"computedStyleRef",name:D,op:function(e){var O=e.you||e.me;if(O)return F.resolveComputedStyle(O,D)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}return{type:"styleRef",name:D,op:function(e){var O=e.you||e.me;if(O)return F.resolveStyle(O,D)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));F.addGrammarElement("objectKey",(function(O,F,P){var M;if(M=P.matchTokenType("STRING"))return{type:"objectKey",key:M.value,evaluate:function(){return M.value}};if(P.matchOpToken("[")){var D=O.parseElement("expression",P);P.requireOpToken("]");return{type:"objectKey",expr:D,args:[D],op:function(e,O){return O},evaluate:function(O){return F.unifiedEval(this||e,O)}}}var _="";do{M=P.matchTokenType("IDENTIFIER")||P.matchOpToken("-");M&&(_+=M.value)}while(M);return{type:"objectKey",key:_,evaluate:function(){return _}}}));F.addLeafExpression("objectLiteral",(function(O,F,P){if(P.matchOpToken("{")){var M=[];var D=[];if(!P.matchOpToken("}")){do{var _=O.requireElement("objectKey",P);P.requireOpToken(":");var G=O.requireElement("expression",P);D.push(G);M.push(_)}while(P.matchOpToken(",")&&!P.peekToken("}",0,"R_BRACE"));P.requireOpToken("}")}return{type:"objectLiteral",args:[M,D],op:function(e,O,F){var P={};for(var M=0;M<O.length;M++)P[O[M]]=F[M];return P},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));F.addGrammarElement("nakedNamedArgumentList",(function(O,F,P){var M=[];var D=[];if(P.currentToken().type==="IDENTIFIER")do{var _=P.requireTokenType("IDENTIFIER");P.requireOpToken(":");var G=O.requireElement("expression",P);D.push(G);M.push({name:_,value:G})}while(P.matchOpToken(","));return{type:"namedArgumentList",fields:M,args:[D],op:function(e,O){var F={_namedArgList_:true};for(var P=0;P<O.length;P++){var D=M[P];F[D.name.value]=O[P]}return F},evaluate:function(O){return F.unifiedEval(this||e,O)}}}));F.addGrammarElement("namedArgumentList",(function(e,O,F){if(F.matchOpToken("(")){var P=e.requireElement("nakedNamedArgumentList",F);F.requireOpToken(")");return P}}));F.addGrammarElement("symbol",(function(e,O,F){var P="default";if(F.matchToken("global"))P="global";else if(F.matchToken("element")||F.matchToken("module")){P="element";F.matchOpToken("'")&&F.requireToken("s")}else F.matchToken("local")&&(P="local");let M=F.matchOpToken(":");let D=F.matchTokenType("IDENTIFIER");if(D&&D.value){var _=D.value;M&&(_=":"+_);if(P==="default"){_.indexOf("$")===0&&(P="global");_.indexOf(":")===0&&(P="element")}return{type:"symbol",token:D,scope:P,name:_,evaluate:function(e){return O.resolveSymbol(_,e,P)}}}}));F.addGrammarElement("implicitMeTarget",(function(e,O,F){return{type:"implicitMeTarget",evaluate:function(e){return e.you||e.me}}}));F.addLeafExpression("boolean",(function(e,O,F){var P=F.matchToken("true")||F.matchToken("false");if(!P)return;const M=P.value==="true";return{type:"boolean",evaluate:function(e){return M}}}));F.addLeafExpression("null",(function(e,O,F){if(F.matchToken("null"))return{type:"null",evaluate:function(e){return null}}}));F.addLeafExpression("arrayLiteral",(function(O,F,P){if(P.matchOpToken("[")){var M=[];if(!P.matchOpToken("]")){do{var D=O.requireElement("expression",P);M.push(D)}while(P.matchOpToken(","));P.requireOpToken("]")}return{type:"arrayLiteral",values:M,args:[M],op:function(e,O){return O},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));F.addLeafExpression("blockLiteral",(function(e,O,F){if(F.matchOpToken("\\")){var P=[];var M=F.matchTokenType("IDENTIFIER");if(M){P.push(M);while(F.matchOpToken(","))P.push(F.requireTokenType("IDENTIFIER"))}F.requireOpToken("-");F.requireOpToken(">");var D=e.requireElement("expression",F);return{type:"blockLiteral",args:P,expr:D,evaluate:function(e){var t=function(){for(var O=0;O<P.length;O++)e.locals[P[O].value]=arguments[O];return D.evaluate(e)};return t}}}}));F.addIndirectExpression("propertyAccess",(function(O,F,P,M){if(P.matchOpToken(".")){var D=P.requireTokenType("IDENTIFIER");var _={type:"propertyAccess",root:M,prop:D,args:[M],op:function(e,O){var P=F.resolveProperty(O,D.value);return P},evaluate:function(O){return F.unifiedEval(this||e,O)}};return O.parseElement("indirectExpression",P,_)}}));F.addIndirectExpression("of",(function(O,F,P,M){if(P.matchToken("of")){var D=O.requireElement("unaryExpression",P);var _=null;var G=M;while(G.root){_=G;G=G.root}G.type!=="symbol"&&G.type!=="attributeRef"&&G.type!=="styleRef"&&G.type!=="computedStyleRef"&&O.raiseParseError(P,"Cannot take a property of a non-symbol: "+G.type);var H=G.type==="attributeRef";var j=G.type==="styleRef"||G.type==="computedStyleRef";if(H||j)var U=G;var W=G.name;var B={type:"ofExpression",prop:G.token,root:D,attribute:U,expression:M,args:[D],op:function(e,O){return H?F.resolveAttribute(O,W):j?G.type==="computedStyleRef"?F.resolveComputedStyle(O,W):F.resolveStyle(O,W):F.resolveProperty(O,W)},evaluate:function(O){return F.unifiedEval(this||e,O)}};G.type==="attributeRef"&&(B.attribute=G);if(_){_.root=B;_.args=[B]}else M=B;return O.parseElement("indirectExpression",P,M)}}));F.addIndirectExpression("possessive",(function(O,F,P,M){if(!O.possessivesDisabled){var D=P.matchOpToken("'");if(D||M.type==="symbol"&&(M.name==="my"||M.name==="its"||M.name==="your")&&(P.currentToken().type==="IDENTIFIER"||P.currentToken().type==="ATTRIBUTE_REF"||P.currentToken().type==="STYLE_REF")){D&&P.requireToken("s");var _,G,H;_=O.parseElement("attributeRef",P);if(_==null){G=O.parseElement("styleRef",P);G==null&&(H=P.requireTokenType("IDENTIFIER"))}var j={type:"possessive",root:M,attribute:_||G,prop:H,args:[M],op:function(e,O){if(_)var P=F.resolveAttribute(O,_.name);else if(G){P=G.type==="computedStyleRef"?F.resolveComputedStyle(O,G.name):F.resolveStyle(O,G.name)}else P=F.resolveProperty(O,H.value);return P},evaluate:function(O){return F.unifiedEval(this||e,O)}};return O.parseElement("indirectExpression",P,j)}}}));F.addIndirectExpression("inExpression",(function(O,F,P,M){if(P.matchToken("in")){var D=O.requireElement("unaryExpression",P);var _={type:"inExpression",root:M,args:[M,D],op:function(e,O,P){var M=[];if(O.css)F.implicitLoop(P,(function(e){var F=e.querySelectorAll(O.css);for(var P=0;P<F.length;P++)M.push(F[P])}));else if(O instanceof Element){var D=false;F.implicitLoop(P,(function(e){e.contains(O)&&(D=true)}));if(D)return O}else F.implicitLoop(O,(function(e){F.implicitLoop(P,(function(O){e===O&&M.push(e)}))}));return M},evaluate:function(O){return F.unifiedEval(this||e,O)}};return O.parseElement("indirectExpression",P,_)}}));F.addIndirectExpression("asExpression",(function(O,F,P,M){if(P.matchToken("as")){P.matchToken("a")||P.matchToken("an");var D=O.requireElement("dotOrColonPath",P).evaluate();var _={type:"asExpression",root:M,args:[M],op:function(e,O){return F.convertValue(O,D)},evaluate:function(O){return F.unifiedEval(this||e,O)}};return O.parseElement("indirectExpression",P,_)}}));F.addIndirectExpression("functionCall",(function(O,F,P,M){if(P.matchOpToken("(")){var D=[];if(!P.matchOpToken(")")){do{D.push(O.requireElement("expression",P))}while(P.matchOpToken(","));P.requireOpToken(")")}if(M.root)var _={type:"functionCall",root:M,argExressions:D,args:[M.root,D],op:function(e,O,P){F.nullCheck(O,M.root);var D=O[M.prop.value];F.nullCheck(D,M);D.hyperfunc&&P.push(e);return D.apply(O,P)},evaluate:function(O){return F.unifiedEval(this||e,O)}};else _={type:"functionCall",root:M,argExressions:D,args:[M,D],op:function(e,O,P){F.nullCheck(O,M);O.hyperfunc&&P.push(e);var D=O.apply(null,P);return D},evaluate:function(O){return F.unifiedEval(this||e,O)}};return O.parseElement("indirectExpression",P,_)}}));F.addIndirectExpression("attributeRefAccess",(function(O,F,P,M){var D=O.parseElement("attributeRef",P);if(D){var _={type:"attributeRefAccess",root:M,attribute:D,args:[M],op:function(e,O){var P=F.resolveAttribute(O,D.name);return P},evaluate:function(O){return F.unifiedEval(this||e,O)}};return _}}));F.addIndirectExpression("arrayIndex",(function(O,F,P,M){if(P.matchOpToken("[")){var D=false;var _=false;var G=null;var H=null;if(P.matchOpToken("..")){D=true;G=O.requireElement("expression",P)}else{G=O.requireElement("expression",P);if(P.matchOpToken("..")){_=true;var j=P.currentToken();j.type!=="R_BRACKET"&&(H=O.parseElement("expression",P))}}P.requireOpToken("]");var U={type:"arrayIndex",root:M,prop:G,firstIndex:G,secondIndex:H,args:[M,G,H],op:function(e,O,F,P){if(O==null)return null;if(D){F<0&&(F=O.length+F);return O.slice(0,F+1)}if(_){if(P!=null){P<0&&(P=O.length+P);return O.slice(F,P+1)}return O.slice(F)}return O[F]},evaluate:function(O){return F.unifiedEval(this||e,O)}};return O.parseElement("indirectExpression",P,U)}}));var P=["em","ex","cap","ch","ic","rem","lh","rlh","vw","vh","vi","vb","vmin","vmax","cm","mm","Q","pc","pt","px"];F.addGrammarElement("postfixExpression",(function(O,F,M){var D=O.parseElement("negativeNumber",M);let _=M.matchAnyToken.apply(M,P)||M.matchOpToken("%");if(_)return{type:"stringPostfix",postfix:_.value,args:[D],op:function(e,O){return""+O+_.value},evaluate:function(O){return F.unifiedEval(this||e,O)}};var G=null;M.matchToken("s")||M.matchToken("seconds")?G=1e3:(M.matchToken("ms")||M.matchToken("milliseconds"))&&(G=1);if(G)return{type:"timeExpression",time:D,factor:G,args:[D],op:function(e,O){return O*G},evaluate:function(O){return F.unifiedEval(this||e,O)}};if(M.matchOpToken(":")){var H=M.requireTokenType("IDENTIFIER");if(!H.value)return;var j=!M.matchOpToken("!");return{type:"typeCheck",typeName:H,nullOk:j,args:[D],op:function(O,P){var M=F.typeCheck(P,(this||e).typeName.value,j);if(M)return P;throw new Error("Typecheck failed!  Expected: "+H.value)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}return D}));F.addGrammarElement("logicalNot",(function(O,F,P){if(P.matchToken("not")){var M=O.requireElement("unaryExpression",P);return{type:"logicalNot",root:M,args:[M],op:function(e,O){return!O},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));F.addGrammarElement("noExpression",(function(O,F,P){if(P.matchToken("no")){var M=O.requireElement("unaryExpression",P);return{type:"noExpression",root:M,args:[M],op:function(e,O){return F.isEmpty(O)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));F.addLeafExpression("some",(function(O,F,P){if(P.matchToken("some")){var M=O.requireElement("expression",P);return{type:"noExpression",root:M,args:[M],op:function(e,O){return!F.isEmpty(O)},evaluate(O){return F.unifiedEval(this||e,O)}}}}));F.addGrammarElement("negativeNumber",(function(O,F,P){if(P.matchOpToken("-")){var M=O.requireElement("negativeNumber",P);return{type:"negativeNumber",root:M,args:[M],op:function(e,O){return-1*O},evaluate:function(O){return F.unifiedEval(this||e,O)}}}return O.requireElement("primaryExpression",P)}));F.addGrammarElement("unaryExpression",(function(e,O,F){F.matchToken("the");return e.parseAnyOf(["beepExpression","logicalNot","relativePositionalExpression","positionalExpression","noExpression","postfixExpression"],F)}));F.addGrammarElement("beepExpression",(function(e,O,F){if(F.matchToken("beep!")){var P=e.parseElement("unaryExpression",F);if(P){P.booped=true;var M=P.evaluate;P.evaluate=function(e){let F=M.apply(P,arguments);let D=e.me;O.beepValueToConsole(D,P,F);return F};return P}}}));var s=function(e,O,F,P){var M=O.querySelectorAll(F);for(var D=0;D<M.length;D++){var _=M[D];if(_.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_PRECEDING)return _}if(P)return M[0]};var u=function(e,O,F,P){var M=O.querySelectorAll(F);for(var D=M.length-1;D>=0;D--){var _=M[D];if(_.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_FOLLOWING)return _}if(P)return M[M.length-1]};var l=function(e,O,F,P){var M=[];o.prototype.forEach(O,(function(O){(O.matches(F)||O===e)&&M.push(O)}));for(var D=0;D<M.length-1;D++){var _=M[D];if(_===e)return M[D+1]}if(P){var G=M[0];if(G&&G.matches(F))return G}};var c=function(e,O,F,P){return l(e,Array.from(O).reverse(),F,P)};F.addGrammarElement("relativePositionalExpression",(function(O,F,P){var M=P.matchAnyToken("next","previous");if(M){var D=M.value==="next";var _=O.parseElement("expression",P);if(P.matchToken("from")){P.pushFollow("in");try{var G=O.requireElement("unaryExpression",P)}finally{P.popFollow()}}else G=O.requireElement("implicitMeTarget",P);var H=false;var j;if(P.matchToken("in")){H=true;var U=O.requireElement("unaryExpression",P)}else j=P.matchToken("within")?O.requireElement("unaryExpression",P):document.body;var W=false;if(P.matchToken("with")){P.requireToken("wrapping");W=true}return{type:"relativePositionalExpression",from:G,forwardSearch:D,inSearch:H,wrapping:W,inElt:U,withinElt:j,operator:M.value,args:[_,G,U,j],op:function(e,O,F,P,M){var G=O.css;if(G==null)throw"Expected a CSS value to be returned by "+i.sourceFor.apply(_);if(H){if(P)return D?l(F,P,G,W):c(F,P,G,W)}else if(M)return D?s(F,M,G,W):u(F,M,G,W)},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));F.addGrammarElement("positionalExpression",(function(O,F,P){var M=P.matchAnyToken("first","last","random");if(!M)return;P.matchAnyToken("in","from","of");var D=O.requireElement("unaryExpression",P);const _=M.value;return{type:"positionalExpression",rhs:D,operator:M.value,args:[D],op:function(e,O){O&&!Array.isArray(O)&&(O=O.children?O.children:Array.from(O));if(O){if(_==="first")return O[0];if(_==="last")return O[O.length-1];if(_==="random")return O[Math.floor(Math.random()*O.length)]}},evaluate:function(O){return F.unifiedEval(this||e,O)}}}));F.addGrammarElement("mathOperator",(function(O,F,P){var M=O.parseElement("unaryExpression",P);var D,_=null;D=P.matchAnyOpToken("+","-","*","/")||P.matchToken("mod");while(D){_=_||D;var G=D.value;_.value!==G&&O.raiseParseError(P,"You must parenthesize math operations with different operators");var H=O.parseElement("unaryExpression",P);M={type:"mathOperator",lhs:M,rhs:H,operator:G,args:[M,H],op:function(e,O,F){return G==="+"?O+F:G==="-"?O-F:G==="*"?O*F:G==="/"?O/F:G==="mod"?O%F:void 0},evaluate:function(O){return F.unifiedEval(this||e,O)}};D=P.matchAnyOpToken("+","-","*","/")||P.matchToken("mod")}return M}));F.addGrammarElement("mathExpression",(function(e,O,F){return e.parseAnyOf(["mathOperator","unaryExpression"],F)}));function f(e,O,F){if(O.contains)return O.contains(F);if(O.includes)return O.includes(F);throw Error("The value of "+e.sourceFor()+" does not have a contains or includes method on it")}function p(e,O,F){if(O.match)return!!O.match(F);if(O.matches)return O.matches(F);throw Error("The value of "+e.sourceFor()+" does not have a match or matches method on it")}F.addGrammarElement("comparisonOperator",(function(O,F,P){var M=O.parseElement("mathExpression",P);var D=P.matchAnyOpToken("<",">","<=",">=","==","===","!=","!==");var _=D?D.value:null;var G=true;var H=false;if(_==null)if(P.matchToken("is")||P.matchToken("am"))if(P.matchToken("not"))if(P.matchToken("in"))_="not in";else if(P.matchToken("a")||P.matchToken("an")){_="not a";H=true}else if(P.matchToken("empty")){_="not empty";G=false}else{_=P.matchToken("really")?"!==":"!=";P.matchToken("equal")&&P.matchToken("to")}else if(P.matchToken("in"))_="in";else if(P.matchToken("a")||P.matchToken("an")){_="a";H=true}else if(P.matchToken("empty")){_="empty";G=false}else if(P.matchToken("less")){P.requireToken("than");if(P.matchToken("or")){P.requireToken("equal");P.requireToken("to");_="<="}else _="<"}else if(P.matchToken("greater")){P.requireToken("than");if(P.matchToken("or")){P.requireToken("equal");P.requireToken("to");_=">="}else _=">"}else{_=P.matchToken("really")?"===":"==";P.matchToken("equal")&&P.matchToken("to")}else if(P.matchToken("equals"))_="==";else if(P.matchToken("really")){P.requireToken("equals");_="==="}else if(P.matchToken("exist")||P.matchToken("exists")){_="exist";G=false}else if(P.matchToken("matches")||P.matchToken("match"))_="match";else if(P.matchToken("contains")||P.matchToken("contain"))_="contain";else if(P.matchToken("includes")||P.matchToken("include"))_="include";else if(P.matchToken("do")||P.matchToken("does")){P.requireToken("not");if(P.matchToken("matches")||P.matchToken("match"))_="not match";else if(P.matchToken("contains")||P.matchToken("contain"))_="not contain";else if(P.matchToken("exist")||P.matchToken("exist")){_="not exist";G=false}else P.matchToken("include")?_="not include":O.raiseParseError(P,"Expected matches or contains")}if(_){var j,U,W;if(H){j=P.requireTokenType("IDENTIFIER");U=!P.matchOpToken("!")}else if(G){W=O.requireElement("mathExpression",P);_!=="match"&&_!=="not match"||(W=W.css?W.css:W)}var B=M;M={type:"comparisonOperator",operator:_,typeName:j,nullOk:U,lhs:M,rhs:W,args:[M,W],op:function(e,O,P){if(_==="==")return O==P;if(_==="!=")return O!=P;if(_==="===")return O===P;if(_==="!==")return O!==P;if(_==="match")return O!=null&&p(B,O,P);if(_==="not match")return O==null||!p(B,O,P);if(_==="in")return P!=null&&f(W,P,O);if(_==="not in")return P==null||!f(W,P,O);if(_==="contain")return O!=null&&f(B,O,P);if(_==="not contain")return O==null||!f(B,O,P);if(_==="include")return O!=null&&f(B,O,P);if(_==="not include")return O==null||!f(B,O,P);if(_==="===")return O===P;if(_==="!==")return O!==P;if(_==="<")return O<P;if(_===">")return O>P;if(_==="<=")return O<=P;if(_===">=")return O>=P;if(_==="empty")return F.isEmpty(O);if(_==="not empty")return!F.isEmpty(O);if(_==="exist")return F.doesExist(O);if(_==="not exist")return!F.doesExist(O);if(_==="a")return F.typeCheck(O,j.value,U);if(_==="not a")return!F.typeCheck(O,j.value,U);throw"Unknown comparison : "+_},evaluate:function(O){return F.unifiedEval(this||e,O)}}}return M}));F.addGrammarElement("comparisonExpression",(function(e,O,F){return e.parseAnyOf(["comparisonOperator","mathExpression"],F)}));F.addGrammarElement("logicalOperator",(function(O,F,P){var M=O.parseElement("comparisonExpression",P);var D,_=null;D=P.matchToken("and")||P.matchToken("or");while(D){_=_||D;_.value!==D.value&&O.raiseParseError(P,"You must parenthesize logical operations with different operators");var G=O.requireElement("comparisonExpression",P);const H=D.value;M={type:"logicalOperator",operator:H,lhs:M,rhs:G,args:[M,G],op:function(e,O,F){return H==="and"?O&&F:O||F},evaluate:function(O){return F.unifiedEval(this||e,O,H==="or")}};D=P.matchToken("and")||P.matchToken("or")}return M}));F.addGrammarElement("logicalExpression",(function(e,O,F){return e.parseAnyOf(["logicalOperator","mathExpression"],F)}));F.addGrammarElement("asyncExpression",(function(O,F,P){if(P.matchToken("async")){var M=O.requireElement("logicalExpression",P);var D={type:"asyncExpression",value:M,evaluate:function(O){return{asyncWrapper:true,value:(this||e).value.evaluate(O)}}};return D}return O.parseElement("logicalExpression",P)}));F.addGrammarElement("expression",(function(e,O,F){F.matchToken("the");return e.parseElement("asyncExpression",F)}));F.addGrammarElement("assignableExpression",(function(e,O,F){F.matchToken("the");var P=e.parseElement("primaryExpression",F);if(P&&(P.type==="symbol"||P.type==="ofExpression"||P.type==="propertyAccess"||P.type==="attributeRefAccess"||P.type==="attributeRef"||P.type==="styleRef"||P.type==="arrayIndex"||P.type==="possessive"))return P;e.raiseParseError(F,"A target expression must be writable.  The expression type '"+(P&&P.type)+"' is not.");return P}));F.addGrammarElement("hyperscript",(function(e,O,F){var P=[];if(F.hasMore())while(e.featureStart(F.currentToken())||F.currentToken().value==="("){var M=e.requireElement("feature",F);P.push(M);F.matchToken("end")}return{type:"hyperscript",features:P,apply:function(e,O,F){for(const M of P)M.install(e,O,F)}}}));var v=function(e){var O=[];if(e.token(0).value==="("&&(e.token(1).value===")"||e.token(2).value===","||e.token(2).value===")")){e.matchOpToken("(");do{O.push(e.requireTokenType("IDENTIFIER"))}while(e.matchOpToken(","));e.requireOpToken(")")}return O};F.addFeature("on",(function(e,O,F){if(F.matchToken("on")){var P=false;F.matchToken("every")&&(P=true);var M=[];var D=null;do{var _=e.requireElement("eventName",F,"Expected event name");var G=_.evaluate();D=D?D+" or "+G:"on "+G;var H=v(F);var j=null;if(F.matchOpToken("[")){j=e.requireElement("expression",F);F.requireOpToken("]")}var U,W,B;if(F.currentToken().type==="NUMBER"){var V=F.consumeToken();if(!V.value)return;U=parseInt(V.value);if(F.matchToken("to")){var z=F.consumeToken();if(!z.value)return;W=parseInt(z.value)}else if(F.matchToken("and")){B=true;F.requireToken("on")}}var Q,Y;if(G==="intersection"){Q={};F.matchToken("with")&&(Q.with=e.requireElement("expression",F).evaluate());if(F.matchToken("having"))do{F.matchToken("margin")?Q.rootMargin=e.requireElement("stringLike",F).evaluate():F.matchToken("threshold")?Q.threshold=e.requireElement("expression",F).evaluate():e.raiseParseError(F,"Unknown intersection config specification")}while(F.matchToken("and"))}else if(G==="mutation"){Y={};if(F.matchToken("of"))do{if(F.matchToken("anything")){Y.attributes=true;Y.subtree=true;Y.characterData=true;Y.childList=true}else if(F.matchToken("childList"))Y.childList=true;else if(F.matchToken("attributes")){Y.attributes=true;Y.attributeOldValue=true}else if(F.matchToken("subtree"))Y.subtree=true;else if(F.matchToken("characterData")){Y.characterData=true;Y.characterDataOldValue=true}else if(F.currentToken().type==="ATTRIBUTE_REF"){var $=F.consumeToken();Y.attributeFilter==null&&(Y.attributeFilter=[]);$.value.indexOf("@")==0?Y.attributeFilter.push($.value.substring(1)):e.raiseParseError(F,"Only shorthand attribute references are allowed here")}else e.raiseParseError(F,"Unknown mutation config specification")}while(F.matchToken("or"));else{Y.attributes=true;Y.characterData=true;Y.childList=true}}var K=null;var X=false;if(F.matchToken("from"))if(F.matchToken("elsewhere"))X=true;else{F.pushFollow("or");try{K=e.requireElement("expression",F)}finally{F.popFollow()}K||e.raiseParseError(F,'Expected either target value or "elsewhere".')}K===null&&X===false&&F.matchToken("elsewhere")&&(X=true);if(F.matchToken("in"))var J=e.parseElement("unaryExpression",F);if(F.matchToken("debounced")){F.requireToken("at");var Z=e.requireElement("unaryExpression",F);var ee=Z.evaluate({})}else if(F.matchToken("throttled")){F.requireToken("at");Z=e.requireElement("unaryExpression",F);var te=Z.evaluate({})}M.push({execCount:0,every:P,on:G,args:H,filter:j,from:K,inExpr:J,elsewhere:X,startCount:U,endCount:W,unbounded:B,debounceTime:ee,throttleTime:te,mutationSpec:Y,intersectionSpec:Q,debounced:void 0,lastExec:void 0})}while(F.matchToken("or"));var re=true;if(!P&&F.matchToken("queue"))if(F.matchToken("all")){re=false}else if(F.matchToken("first"))var ne=true;else if(F.matchToken("none"))var ae=true;else F.requireToken("last");var ie=e.requireElement("commandList",F);e.ensureTerminated(ie);var oe,se;if(F.matchToken("catch")){oe=F.requireTokenType("IDENTIFIER").value;se=e.requireElement("commandList",F);e.ensureTerminated(se)}if(F.matchToken("finally")){var ue=e.requireElement("commandList",F);e.ensureTerminated(ue)}var le={displayName:D,events:M,start:ie,every:P,execCount:0,errorHandler:se,errorSymbol:oe,execute:function(e){let F=O.getEventQueueFor(e.me,le);if(F.executing&&P===false){if(ae||ne&&F.queue.length>0)return;re&&(F.queue.length=0);F.queue.push(e)}else{le.execCount++;F.executing=true;e.meta.onHalt=function(){F.executing=false;var e=F.queue.shift();e&&setTimeout((function(){le.execute(e)}),1)};e.meta.reject=function(F){console.error(F.message?F.message:F);var P=O.getHyperTrace(e,F);P&&P.print();O.triggerEvent(e.me,"exception",{error:F})};ie.execute(e)}},install:function(e,F){for(const F of le.events){var P;P=F.elsewhere?[document]:F.from?F.from.evaluate(O.makeContext(e,le,e,null)):[e];O.implicitLoop(P,(function(P){var M=F.on;if(P!=null){if(F.mutationSpec){M="hyperscript:mutation";const e=new MutationObserver((function(e,F){le.executing||O.triggerEvent(P,M,{mutationList:e,observer:F})}));e.observe(P,F.mutationSpec)}if(F.intersectionSpec){M="hyperscript:intersection";const e=new IntersectionObserver((function(F){for(const _ of F){var D={observer:e};D=Object.assign(D,_);D.intersecting=_.isIntersecting;O.triggerEvent(P,M,D)}}),F.intersectionSpec);e.observe(P)}var _=P.addEventListener||P.on;_.call(P,M,(function a(D){if(typeof Node!=="undefined"&&e instanceof Node&&P!==e&&!e.isConnected)P.removeEventListener(M,a);else{var _=O.makeContext(e,le,e,D);if(!F.elsewhere||!e.contains(D.target)){F.from&&(_.result=P);for(const e of F.args){let O=_.event[e.value];O!==void 0?_.locals[e.value]=O:"detail"in _.event&&(_.locals[e.value]=_.event.detail[e.value])}_.meta.errorHandler=se;_.meta.errorSymbol=oe;_.meta.finallyHandler=ue;if(F.filter){var G=_.meta.context;_.meta.context=_.event;try{var H=F.filter.evaluate(_);if(!H)return}finally{_.meta.context=G}}if(F.inExpr){var j=D.target;while(true){if(j.matches&&j.matches(F.inExpr.css)){_.result=j;break}j=j.parentElement;if(j==null)return}}F.execCount++;if(F.startCount)if(F.endCount){if(F.execCount<F.startCount||F.execCount>F.endCount)return}else if(F.unbounded){if(F.execCount<F.startCount)return}else if(F.execCount!==F.startCount)return;if(F.debounceTime){F.debounced&&clearTimeout(F.debounced);F.debounced=setTimeout((function(){le.execute(_)}),F.debounceTime)}else{if(F.throttleTime){if(F.lastExec&&Date.now()<F.lastExec+F.throttleTime)return;F.lastExec=Date.now()}le.execute(_)}}}}))}else console.warn("'%s' feature ignored because target does not exists:",D,e)}))}}};e.setParent(ie,le);return le}}));F.addFeature("def",(function(e,O,F){if(F.matchToken("def")){var P=e.requireElement("dotOrColonPath",F);var M=P.evaluate();var D=M.split(".");var _=D.pop();var G=[];if(F.matchOpToken("("))if(F.matchOpToken(")"));else{do{G.push(F.requireTokenType("IDENTIFIER"))}while(F.matchOpToken(","));F.requireOpToken(")")}var H=e.requireElement("commandList",F);var j,U;if(F.matchToken("catch")){j=F.requireTokenType("IDENTIFIER").value;U=e.parseElement("commandList",F)}if(F.matchToken("finally")){var W=e.requireElement("commandList",F);e.ensureTerminated(W)}var B={displayName:_+"("+G.map((function(e){return e.value})).join(", ")+")",name:_,args:G,start:H,errorHandler:U,errorSymbol:j,finallyHandler:W,install:function(e,F){var n=function(){var P=O.makeContext(F,B,e,null);P.meta.errorHandler=U;P.meta.errorSymbol=j;P.meta.finallyHandler=W;for(var M=0;M<G.length;M++){var D=G[M];var _=arguments[M];D&&(P.locals[D.value]=_)}P.meta.caller=arguments[G.length];P.meta.caller&&(P.meta.callingCommand=P.meta.caller.meta.command);var V,z=null;var Q=new Promise((function(e,O){V=e;z=O}));H.execute(P);if(P.meta.returned)return P.meta.returnValue;P.meta.resolve=V;P.meta.reject=z;return Q};n.hyperfunc=true;n.hypername=M;O.assignToNamespace(e,D,_,n)}};e.ensureTerminated(H);U&&e.ensureTerminated(U);e.setParent(H,B);return B}}));F.addFeature("set",(function(e,O,F){let P=e.parseElement("setCommand",F);if(P){P.target.scope!=="element"&&e.raiseParseError(F,"variables declared at the feature level must be element scoped.");let M={start:P,install:function(e,F){P&&P.execute(O.makeContext(e,M,e,null))}};e.ensureTerminated(P);return M}}));F.addFeature("init",(function(e,O,F){if(F.matchToken("init")){var P=F.matchToken("immediately");var M=e.requireElement("commandList",F);var D={start:M,install:function(e,F){let o=function(){M&&M.execute(O.makeContext(e,D,e,null))};P?o():setTimeout(o,0)}};e.ensureTerminated(M);e.setParent(M,D);return D}}));F.addFeature("worker",(function(e,O,F){F.matchToken("worker")&&e.raiseParseError(F,"In order to use the 'worker' feature, include the _hyperscript worker plugin. See https://hyperscript.org/features/worker/ for more info.")}));F.addFeature("behavior",(function(e,F,P){if(P.matchToken("behavior")){var M=e.requireElement("dotOrColonPath",P).evaluate();var D=M.split(".");var _=D.pop();var G=[];if(P.matchOpToken("(")&&!P.matchOpToken(")")){do{G.push(P.requireTokenType("IDENTIFIER").value)}while(P.matchOpToken(","));P.requireOpToken(")")}var H=e.requireElement("hyperscript",P);for(var j=0;j<H.features.length;j++){var U=H.features[j];U.behavior=M}return{install:function(e,P){F.assignToNamespace(O.document&&O.document.body,D,_,(function(e,O,P){var D=F.getInternalData(e);var _=h(D,M+"Scope");for(var j=0;j<G.length;j++)_[G[j]]=P[G[j]];H.apply(e,O)}))}}}}));F.addFeature("install",(function(e,F,P){if(P.matchToken("install")){var M=e.requireElement("dotOrColonPath",P).evaluate();var D=M.split(".");var _=e.parseElement("namedArgumentList",P);var G;return G={install:function(e,P){F.unifiedEval({args:[_],op:function(F,_){var G=O;for(var H=0;H<D.length;H++){G=G[D[H]];if(typeof G!=="object"&&typeof G!=="function")throw new Error("No such behavior defined as "+M)}if(!(G instanceof Function))throw new Error(M+" is not a behavior");G(e,P,_)}},F.makeContext(e,G,e,null))}}}}));F.addGrammarElement("jsBody",(function(e,O,F){var P=F.currentToken().start;var M=F.currentToken();var D=[];var _="";var G=false;while(F.hasMore()){M=F.consumeToken();var H=F.token(0,true);if(H.type==="IDENTIFIER"&&H.value==="end")break;if(G)if(M.type==="IDENTIFIER"||M.type==="NUMBER")_+=M.value;else{_!==""&&D.push(_);_="";G=false}else M.type==="IDENTIFIER"&&M.value==="function"&&(G=true)}var j=M.end+1;return{type:"jsBody",exposedFunctionNames:D,jsSource:F.source.substring(P,j)}}));F.addFeature("js",(function(e,F,P){if(P.matchToken("js")){var M=e.requireElement("jsBody",P);var D=M.jsSource+"\nreturn { "+M.exposedFunctionNames.map((function(e){return e+":"+e})).join(",")+" } ";var _=new Function(D);return{jsSource:D,function:_,exposedFunctionNames:M.exposedFunctionNames,install:function(){Object.assign(O,_())}}}}));F.addCommand("js",(function(F,P,M){if(M.matchToken("js")){var D=[];if(M.matchOpToken("("))if(M.matchOpToken(")"));else{do{var _=M.requireTokenType("IDENTIFIER");D.push(_.value)}while(M.matchOpToken(","));M.requireOpToken(")")}var G=F.requireElement("jsBody",M);M.matchToken("end");var H=E(Function,D.concat([G.jsSource]));var j={jsSource:G.jsSource,function:H,inputs:D,op:function(F){var M=[];D.forEach((function(e){M.push(P.resolveSymbol(e,F,"default"))}));var _=H.apply(O,M);if(_&&typeof _.then==="function")return new Promise((function(O){_.then((function(M){F.result=M;O(P.findNext(this||e,F))}))}));F.result=_;return P.findNext(this||e,F)}};return j}}));F.addCommand("async",(function(O,F,P){if(P.matchToken("async")){if(P.matchToken("do")){var M=O.requireElement("commandList",P);var D=M;while(D.next)D=D.next;D.next=F.HALT;P.requireToken("end")}else M=O.requireElement("command",P);var _={body:M,op:function(O){setTimeout((function(){M.execute(O)}));return F.findNext(this||e,O)}};O.setParent(M,_);return _}}));F.addCommand("tell",(function(O,F,P){var M=P.currentToken();if(P.matchToken("tell")){var D=O.requireElement("expression",P);var _=O.requireElement("commandList",P);P.hasMore()&&!O.featureStart(P.currentToken())&&P.requireToken("end");var G="tell_"+M.start;var H={value:D,body:_,args:[D],resolveNext:function(O){var P=O.meta.iterators[G];if(P.index<P.value.length){O.you=P.value[P.index++];return _}O.you=P.originalYou;return(this||e).next?(this||e).next:F.findNext((this||e).parent,O)},op:function(e,O){O==null?O=[]:Array.isArray(O)||O instanceof NodeList||(O=[O]);e.meta.iterators[G]={originalYou:e.you,index:0,value:O};return this.resolveNext(e)}};O.setParent(_,H);return H}}));F.addCommand("wait",(function(O,F,P){if(P.matchToken("wait")){var M;if(P.matchToken("for")){P.matchToken("a");var D=[];do{var _=P.token(0);_.type==="NUMBER"||_.type==="L_PAREN"?D.push({time:O.requireElement("expression",P).evaluate()}):D.push({name:O.requireElement("dotOrColonPath",P,"Expected event name").evaluate(),args:v(P)})}while(P.matchToken("or"));if(P.matchToken("from"))var G=O.requireElement("expression",P);M={event:D,on:G,args:[G],op:function(O,P){var M=P||O.me;if(!(M instanceof EventTarget))throw new Error("Not a valid event target: "+(this||e).on.sourceFor());return new Promise((P=>{var _=false;for(const G of D){var o=M=>{O.result=M;if(G.args)for(const e of G.args)O.locals[e.value]=M[e.value]||(M.detail?M.detail[e.value]:null);if(!_){_=true;P(F.findNext(this||e,O))}};G.name?M.addEventListener(G.name,o,{once:true}):G.time!=null&&setTimeout(o,G.time,G.time)}}))}};return M}var H;if(P.matchToken("a")){P.requireToken("tick");H=0}else H=O.requireElement("expression",P);M={type:"waitCmd",time:H,args:[H],op:function(O,P){return new Promise((M=>{setTimeout((()=>{M(F.findNext(this||e,O))}),P)}))},execute:function(O){return F.unifiedExec(this||e,O)}};return M}}));F.addGrammarElement("dotOrColonPath",(function(e,O,F){var P=F.matchTokenType("IDENTIFIER");if(P){var M=[P.value];var D=F.matchOpToken(".")||F.matchOpToken(":");if(D)do{M.push(F.requireTokenType("IDENTIFIER","NUMBER").value)}while(F.matchOpToken(D.value));return{type:"dotOrColonPath",path:M,evaluate:function(){return M.join(D?D.value:"")}}}}));F.addGrammarElement("eventName",(function(e,O,F){var P;return(P=F.matchTokenType("STRING"))?{evaluate:function(){return P.value}}:e.parseElement("dotOrColonPath",F)}));function d(e,O,F,P){var M=O.requireElement("eventName",P);var D=O.parseElement("namedArgumentList",P);if(e==="send"&&P.matchToken("to")||e==="trigger"&&P.matchToken("on"))var _=O.requireElement("expression",P);else _=O.requireElement("implicitMeTarget",P);var G={eventName:M,details:D,to:_,args:[_,M,D],op:function(e,O,P,M){F.nullCheck(O,_);F.implicitLoop(O,(function(O){F.triggerEvent(O,P,M,e.me)}));return F.findNext(G,e)}};return G}F.addCommand("trigger",(function(e,O,F){if(F.matchToken("trigger"))return d("trigger",e,O,F)}));F.addCommand("send",(function(e,O,F){if(F.matchToken("send"))return d("send",e,O,F)}));var T=function(e,O,F,P){if(P)if(e.commandBoundary(F.currentToken()))e.raiseParseError(F,"'return' commands must return a value.  If you do not wish to return a value, use 'exit' instead.");else var M=e.requireElement("expression",F);var D={value:M,args:[M],op:function(e,F){var P=e.meta.resolve;e.meta.returned=true;e.meta.returnValue=F;P&&(F?P(F):P());return O.HALT}};return D};F.addCommand("return",(function(e,O,F){if(F.matchToken("return"))return T(e,O,F,true)}));F.addCommand("exit",(function(e,O,F){if(F.matchToken("exit"))return T(e,O,F,false)}));F.addCommand("halt",(function(O,F,P){if(P.matchToken("halt")){if(P.matchToken("the")){P.requireToken("event");P.matchOpToken("'")&&P.requireToken("s");var M=true}if(P.matchToken("bubbling"))var D=true;else if(P.matchToken("default"))var _=true;var G=T(O,F,P,false);var H={keepExecuting:true,bubbling:D,haltDefault:_,exit:G,op:function(O){if(O.event){if(D)O.event.stopPropagation();else if(_)O.event.preventDefault();else{O.event.stopPropagation();O.event.preventDefault()}return M?F.findNext(this||e,O):G}}};return H}}));F.addCommand("log",(function(O,F,P){if(P.matchToken("log")){var M=[O.parseElement("expression",P)];while(P.matchOpToken(","))M.push(O.requireElement("expression",P));if(P.matchToken("with"))var D=O.requireElement("expression",P);var _={exprs:M,withExpr:D,args:[D,M],op:function(O,P,M){P?P.apply(null,M):console.log.apply(null,M);return F.findNext(this||e,O)}};return _}}));F.addCommand("beep!",(function(O,F,P){if(P.matchToken("beep!")){var M=[O.parseElement("expression",P)];while(P.matchOpToken(","))M.push(O.requireElement("expression",P));var D={exprs:M,args:[M],op:function(O,P){for(let e=0;e<M.length;e++){const D=M[e];const _=P[e];F.beepValueToConsole(O.me,D,_)}return F.findNext(this||e,O)}};return D}}));F.addCommand("throw",(function(e,O,F){if(F.matchToken("throw")){var P=e.requireElement("expression",F);var M={expr:P,args:[P],op:function(e,F){O.registerHyperTrace(e,F);throw F}};return M}}));var y=function(e,O,F){var P=e.requireElement("expression",F);var M={expr:P,args:[P],op:function(e,F){e.result=F;return O.findNext(M,e)}};return M};F.addCommand("call",(function(e,O,F){if(F.matchToken("call")){var P=y(e,O,F);P.expr&&P.expr.type!=="functionCall"&&e.raiseParseError(F,"Must be a function invocation");return P}}));F.addCommand("get",(function(e,O,F){if(F.matchToken("get"))return y(e,O,F)}));F.addCommand("make",(function(O,F,P){if(P.matchToken("make")){P.matchToken("a")||P.matchToken("an");var M=O.requireElement("expression",P);var D=[];if(M.type!=="queryRef"&&P.matchToken("from"))do{D.push(O.requireElement("expression",P))}while(P.matchOpToken(","));if(P.matchToken("called"))var _=O.requireElement("symbol",P);var G;if(M.type==="queryRef"){G={op:function(O){var P,D,G="div",H=[];var j=/(?:(^|#|\.)([^#\. ]+))/g;while(P=j.exec(M.css))P[1]===""?G=P[2].trim():P[1]==="#"?D=P[2].trim():H.push(P[2].trim());var U=document.createElement(G);D!==void 0&&(U.id=D);for(var W=0;W<H.length;W++){var B=H[W];U.classList.add(B)}O.result=U;_&&F.setSymbol(_.name,O,_.scope,U);return F.findNext(this||e,O)}};return G}G={args:[M,D],op:function(O,P,M){O.result=E(P,M);_&&F.setSymbol(_.name,O,_.scope,O.result);return F.findNext(this||e,O)}};return G}}));F.addGrammarElement("pseudoCommand",(function(O,F,P){let M=P.token(1);if(!(M&&M.op&&(M.value==="."||M.value==="(")))return null;var D=O.requireElement("primaryExpression",P);var _=D.root;var G=D;while(_.root!=null){G=G.root;_=_.root}D.type!=="functionCall"&&O.raiseParseError(P,"Pseudo-commands must be function calls");if(G.type==="functionCall"&&G.root.root==null)if(P.matchAnyToken("the","to","on","with","into","from","at"))var H=O.requireElement("expression",P);else if(P.matchToken("me"))H=O.requireElement("implicitMeTarget",P);var j;j=H?{type:"pseudoCommand",root:H,argExressions:G.argExressions,args:[H,G.argExressions],op:function(e,O,P){F.nullCheck(O,H);var M=O[G.root.name];F.nullCheck(M,G);M.hyperfunc&&P.push(e);e.result=M.apply(O,P);return F.findNext(j,e)},execute:function(O){return F.unifiedExec(this||e,O)}}:{type:"pseudoCommand",expr:D,args:[D],op:function(e,O){e.result=O;return F.findNext(j,e)},execute:function(O){return F.unifiedExec(this||e,O)}};return j}));var k=function(O,F,P,M,D){var _=M.type==="symbol";var G=M.type==="attributeRef";var H=M.type==="styleRef";var j=M.type==="arrayIndex";G||H||_||M.root!=null||O.raiseParseError(P,"Can only put directly into symbols, not references");var U=null;var W=null;if(_);else if(G||H){U=O.requireElement("implicitMeTarget",P);var B=M}else if(j){W=M.firstIndex;U=M.root}else{W=M.prop?M.prop.value:null;B=M.attribute;U=M.root}var V={target:M,symbolWrite:_,value:D,args:[U,W,D],op:function(O,P,D,G){if(_)F.setSymbol(M.name,O,M.scope,G);else{F.nullCheck(P,U);j?P[D]=G:F.implicitLoop(P,(function(e){B?B.type==="attributeRef"?G==null?e.removeAttribute(B.name):e.setAttribute(B.name,G):e.style[B.name]=G:e[D]=G}))}return F.findNext(this||e,O)}};return V};F.addCommand("default",(function(O,F,P){if(P.matchToken("default")){var M=O.requireElement("assignableExpression",P);P.requireToken("to");var D=O.requireElement("expression",P);var _=k(O,F,P,M,D);var G={target:M,value:D,setter:_,args:[M],op:function(O,P){return P?F.findNext(this||e,O):_}};_.parent=G;return G}}));F.addCommand("set",(function(O,F,P){if(P.matchToken("set")){if(P.currentToken().type==="L_BRACE"){var M=O.requireElement("objectLiteral",P);P.requireToken("on");var D=O.requireElement("expression",P);var _={objectLiteral:M,target:D,args:[M,D],op:function(O,P,M){Object.assign(M,P);return F.findNext(this||e,O)}};return _}try{P.pushFollow("to");D=O.requireElement("assignableExpression",P)}finally{P.popFollow()}P.requireToken("to");var G=O.requireElement("expression",P);return k(O,F,P,D,G)}}));F.addCommand("if",(function(O,F,P){if(!P.matchToken("if"))return;var M=O.requireElement("expression",P);P.matchToken("then");var D=O.parseElement("commandList",P);var _=false;let G=P.matchToken("else")||P.matchToken("otherwise");if(G){let e=P.peekToken("if");_=e!=null&&e.line===G.line;if(_)var H=O.parseElement("command",P);else H=O.parseElement("commandList",P)}P.hasMore()&&!_&&P.requireToken("end");var j={expr:M,trueBranch:D,falseBranch:H,args:[M],op:function(O,P){return P?D:H||F.findNext(this||e,O)}};O.setParent(D,j);O.setParent(H,j);return j}));var x=function(O,F,P,M){var D=F.currentToken();var _;if(F.matchToken("for")||M){var G=F.requireTokenType("IDENTIFIER");_=G.value;F.requireToken("in");var H=O.requireElement("expression",F)}else if(F.matchToken("in")){_="it";H=O.requireElement("expression",F)}else if(F.matchToken("while"))var j=O.requireElement("expression",F);else if(F.matchToken("until")){var U=true;if(F.matchToken("event")){var W=O.requireElement("dotOrColonPath",F,"Expected event name");if(F.matchToken("from"))var B=O.requireElement("expression",F)}else j=O.requireElement("expression",F)}else if(O.commandBoundary(F.currentToken())||F.currentToken().value==="forever"){F.matchToken("forever");var V=true}else{var z=O.requireElement("expression",F);F.requireToken("times")}if(F.matchToken("index")){G=F.requireTokenType("IDENTIFIER");var Q=G.value}else if(F.matchToken("indexed")){F.requireToken("by");G=F.requireTokenType("IDENTIFIER");Q=G.value}var Y=O.parseElement("commandList",F);if(Y&&W){var $=Y;while($.next)$=$.next;var K={type:"waitATick",op:function(){return new Promise((function(e){setTimeout((function(){e(P.findNext(K))}),0)}))}};$.next=K}F.hasMore()&&F.requireToken("end");if(_==null){_="_implicit_repeat_"+D.start;var X=_}else X=_+"_"+D.start;var J={identifier:_,indexIdentifier:Q,slot:X,expression:H,forever:V,times:z,until:U,event:W,on:B,whileExpr:j,resolveNext:function(){return this||e},loop:Y,args:[j,z],op:function(O,F,M){var D=O.meta.iterators[X];var G=false;var H=null;if((this||e).forever)G=true;else if((this||e).until)G=W?O.meta.iterators[X].eventFired===false:F!==true;else if(j)G=F;else if(M)G=D.index<M;else{var U=D.iterator.next();G=!U.done;H=U.value}if(G){D.value?O.result=O.locals[_]=H:O.result=D.index;Q&&(O.locals[Q]=D.index);D.index++;return Y}O.meta.iterators[X]=null;return P.findNext((this||e).parent,O)}};O.setParent(Y,J);var Z={name:"repeatInit",args:[H,W,B],op:function(e,O,F,P){var M={index:0,value:O,eventFired:false};e.meta.iterators[X]=M;O&&O[Symbol.iterator]&&(M.iterator=O[Symbol.iterator]());if(W){var D=P||e.me;D.addEventListener(F,(function(O){e.meta.iterators[X].eventFired=true}),{once:true})}return J},execute:function(O){return P.unifiedExec(this||e,O)}};O.setParent(J,Z);return Z};F.addCommand("repeat",(function(e,O,F){if(F.matchToken("repeat"))return x(e,F,O,false)}));F.addCommand("for",(function(e,O,F){if(F.matchToken("for"))return x(e,F,O,true)}));F.addCommand("continue",(function(O,F,P){if(P.matchToken("continue")){var M={op:function(F){for(var M=(this||e).parent;true;M=M.parent){M==void 0&&O.raiseParseError(P,"Command `continue` cannot be used outside of a `repeat` loop.");if(M.loop!=void 0)return M.resolveNext(F)}}};return M}}));F.addCommand("break",(function(O,F,P){if(P.matchToken("break")){var M={op:function(M){for(var D=(this||e).parent;true;D=D.parent){D==void 0&&O.raiseParseError(P,"Command `continue` cannot be used outside of a `repeat` loop.");if(D.loop!=void 0)return F.findNext(D.parent,M)}}};return M}}));F.addGrammarElement("stringLike",(function(e,O,F){return e.parseAnyOf(["string","nakedString"],F)}));F.addCommand("append",(function(O,F,P){if(P.matchToken("append")){var M=null;var D=O.requireElement("expression",P);var _={type:"symbol",evaluate:function(e){return F.resolveSymbol("result",e)}};M=P.matchToken("to")?O.requireElement("expression",P):_;var G=null;M.type!=="symbol"&&M.type!=="attributeRef"&&M.root==null||(G=k(O,F,P,M,_));var H={value:D,target:M,args:[M,D],op:function(O,P,M){if(Array.isArray(P)){P.push(M);return F.findNext(this||e,O)}if(P instanceof Element){M instanceof Element?P.insertAdjacentElement("beforeend",M):P.insertAdjacentHTML("beforeend",M);F.processNode(P);return F.findNext(this||e,O)}if(G){O.result=(P||"")+M;return G}throw Error("Unable to append a value!")},execute:function(O){return F.unifiedExec(this||e,O)}};G!=null&&(G.parent=H);return H}}));function g(e,O,F){F.matchToken("at")||F.matchToken("from");const P={includeStart:true,includeEnd:false};P.from=F.matchToken("start")?0:e.requireElement("expression",F);(F.matchToken("to")||F.matchOpToken(".."))&&(F.matchToken("end")?P.toEnd=true:P.to=e.requireElement("expression",F));F.matchToken("inclusive")?P.includeEnd=true:F.matchToken("exclusive")&&(P.includeStart=false);return P}class b{constructor(e,O){this.re=e;this.str=O}next(){const e=this.re.exec(this.str);return e===null?{done:true}:{value:e}}}class w{constructor(e,O,F){this.re=e;this.flags=O;this.str=F}[Symbol.iterator](){return new b(new RegExp(this.re,this.flags),this.str)}}F.addCommand("pick",((O,F,P)=>{if(P.matchToken("pick")){P.matchToken("the");if(P.matchToken("item")||P.matchToken("items")||P.matchToken("character")||P.matchToken("characters")){const M=g(O,F,P);P.requireToken("from");const D=O.requireElement("expression",P);return{args:[D,M.from,M.to],op(O,P,D,_){M.toEnd&&(_=P.length);M.includeStart||D++;M.includeEnd&&_++;_!=null&&_!=void 0||(_=D+1);O.result=P.slice(D,_);return F.findNext(this||e,O)}}}if(P.matchToken("match")){P.matchToken("of");const M=O.parseElement("expression",P);let D="";P.matchOpToken("|")&&(D=P.requireTokenType("IDENTIFIER").value);P.requireToken("from");const _=O.parseElement("expression",P);return{args:[_,M],op(O,P,M){O.result=new RegExp(M,D).exec(P);return F.findNext(this||e,O)}}}if(P.matchToken("matches")){P.matchToken("of");const M=O.parseElement("expression",P);let D="gu";P.matchOpToken("|")&&(D="g"+P.requireTokenType("IDENTIFIER").value.replace("g",""));P.requireToken("from");const _=O.parseElement("expression",P);return{args:[_,M],op(O,P,M){O.result=new w(M,D,P);return F.findNext(this||e,O)}}}}}));F.addCommand("increment",(function(O,F,P){if(P.matchToken("increment")){var M;var D=O.parseElement("assignableExpression",P);P.matchToken("by")&&(M=O.requireElement("expression",P));var _={type:"implicitIncrementOp",target:D,args:[D,M],op:function(e,O,F){O=O?parseFloat(O):0;F=M?parseFloat(F):1;var P=O+F;e.result=P;return P},evaluate:function(O){return F.unifiedEval(this||e,O)}};return k(O,F,P,D,_)}}));F.addCommand("decrement",(function(O,F,P){if(P.matchToken("decrement")){var M;var D=O.parseElement("assignableExpression",P);P.matchToken("by")&&(M=O.requireElement("expression",P));var _={type:"implicitDecrementOp",target:D,args:[D,M],op:function(e,O,F){O=O?parseFloat(O):0;F=M?parseFloat(F):1;var P=O-F;e.result=P;return P},evaluate:function(O){return F.unifiedEval(this||e,O)}};return k(O,F,P,D,_)}}));function S(e,O){var F="text";var P;e.matchToken("a")||e.matchToken("an");e.matchToken("json")||e.matchToken("Object")?F="json":e.matchToken("response")?F="response":e.matchToken("html")?F="html":e.matchToken("text")||(P=O.requireElement("dotOrColonPath",e).evaluate());return{type:F,conversion:P}}F.addCommand("fetch",(function(e,O,F){if(F.matchToken("fetch")){var P=e.requireElement("stringLike",F);if(F.matchToken("as"))var M=S(F,e);if(F.matchToken("with")&&F.currentToken().value!=="{")var D=e.parseElement("nakedNamedArgumentList",F);else D=e.parseElement("objectLiteral",F);M==null&&F.matchToken("as")&&(M=S(F,e));var _=M?M.type:"text";var G=M?M.conversion:null;var H={url:P,argExpressions:D,args:[P,D],op:function(e,F,P){var M=P||{};M.sender=e.me;M.headers=M.headers||{};var D=new AbortController;let j=e.me.addEventListener("fetch:abort",(function(){D.abort()}),{once:true});M.signal=D.signal;O.triggerEvent(e.me,"hyperscript:beforeFetch",M);O.triggerEvent(e.me,"fetch:beforeRequest",M);P=M;var U=false;P.timeout&&setTimeout((function(){U||D.abort()}),P.timeout);return fetch(F,P).then((function(F){let P={response:F};O.triggerEvent(e.me,"fetch:afterResponse",P);F=P.response;if(_==="response"){e.result=F;O.triggerEvent(e.me,"fetch:afterRequest",{result:F});U=true;return O.findNext(H,e)}return _==="json"?F.json().then((function(F){e.result=F;O.triggerEvent(e.me,"fetch:afterRequest",{result:F});U=true;return O.findNext(H,e)})):F.text().then((function(F){G&&(F=O.convertValue(F,G));_==="html"&&(F=O.convertValue(F,"Fragment"));e.result=F;O.triggerEvent(e.me,"fetch:afterRequest",{result:F});U=true;return O.findNext(H,e)}))})).catch((function(F){O.triggerEvent(e.me,"fetch:error",{reason:F});throw F})).finally((function(){e.me.removeEventListener("fetch:abort",j)}))}};return H}}))}function y(O){O.addCommand("settle",(function(O,F,P){if(P.matchToken("settle")){if(O.commandBoundary(P.currentToken()))M=O.requireElement("implicitMeTarget",P);else var M=O.requireElement("expression",P);var D={type:"settleCmd",args:[M],op:function(e,O){F.nullCheck(O,M);var P=null;var _=false;var G=false;var H=new Promise((function(e){P=e}));O.addEventListener("transitionstart",(function(){G=true}),{once:true});setTimeout((function(){G||_||P(F.findNext(D,e))}),500);O.addEventListener("transitionend",(function(){_||P(F.findNext(D,e))}),{once:true});return H},execute:function(O){return F.unifiedExec(this||e,O)}};return D}}));O.addCommand("add",(function(O,F,P){if(P.matchToken("add")){var M=O.parseElement("classRef",P);var D=null;var _=null;if(M==null){D=O.parseElement("attributeRef",P);if(D==null){_=O.parseElement("styleLiteral",P);_==null&&O.raiseParseError(P,"Expected either a class reference or attribute expression")}}else{var G=[M];while(M=O.parseElement("classRef",P))G.push(M)}if(P.matchToken("to"))var H=O.requireElement("expression",P);else H=O.requireElement("implicitMeTarget",P);if(P.matchToken("when")){_&&O.raiseParseError(P,"Only class and properties are supported with a when clause");var j=O.requireElement("expression",P)}return G?{classRefs:G,to:H,args:[H,G],op:function(O,P,M){F.nullCheck(P,H);F.forEach(M,(function(e){F.implicitLoop(P,(function(P){if(j){O.result=P;let M=F.evaluateNoPromise(j,O);M?P instanceof Element&&P.classList.add(e.className):P instanceof Element&&P.classList.remove(e.className);O.result=null}else P instanceof Element&&P.classList.add(e.className)}))}));return F.findNext(this||e,O)}}:D?{type:"addCmd",attributeRef:D,to:H,args:[H],op:function(O,P,M){F.nullCheck(P,H);F.implicitLoop(P,(function(e){if(j){O.result=e;let P=F.evaluateNoPromise(j,O);P?e.setAttribute(D.name,D.value):e.removeAttribute(D.name);O.result=null}else e.setAttribute(D.name,D.value)}));return F.findNext(this||e,O)},execute:function(O){return F.unifiedExec(this||e,O)}}:{type:"addCmd",cssDeclaration:_,to:H,args:[H,_],op:function(O,P,M){F.nullCheck(P,H);F.implicitLoop(P,(function(e){e.style.cssText+=M}));return F.findNext(this||e,O)},execute:function(O){return F.unifiedExec(this||e,O)}}}}));O.addGrammarElement("styleLiteral",(function(O,F,P){if(P.matchOpToken("{")){var M=[""];var D=[];while(P.hasMore()){if(P.matchOpToken("\\"))P.consumeToken();else{if(P.matchOpToken("}"))break;if(P.matchToken("$")){var _=P.matchOpToken("{");var G=O.parseElement("expression",P);_&&P.requireOpToken("}");D.push(G);M.push("")}else{var H=P.consumeToken();M[M.length-1]+=P.source.substring(H.start,H.end)}}M[M.length-1]+=P.lastWhitespace()}return{type:"styleLiteral",args:[D],op:function(e,O){var F="";M.forEach((function(e,P){F+=e;P in O&&(F+=O[P])}));return F},evaluate:function(O){return F.unifiedEval(this||e,O)}}}}));O.addCommand("remove",(function(O,F,P){if(P.matchToken("remove")){var M=O.parseElement("classRef",P);var D=null;var _=null;if(M==null){D=O.parseElement("attributeRef",P);if(D==null){_=O.parseElement("expression",P);_==null&&O.raiseParseError(P,"Expected either a class reference, attribute expression or value expression")}}else{var G=[M];while(M=O.parseElement("classRef",P))G.push(M)}if(P.matchToken("from"))var H=O.requireElement("expression",P);else if(_==null)H=O.requireElement("implicitMeTarget",P);return _?{elementExpr:_,from:H,args:[_,H],op:function(O,P,M){F.nullCheck(P,_);F.implicitLoop(P,(function(e){e.parentElement&&(M==null||M.contains(e))&&e.parentElement.removeChild(e)}));return F.findNext(this||e,O)}}:{classRefs:G,attributeRef:D,elementExpr:_,from:H,args:[G,H],op:function(O,P,M){F.nullCheck(M,H);P?F.forEach(P,(function(e){F.implicitLoop(M,(function(O){O.classList.remove(e.className)}))})):F.implicitLoop(M,(function(e){e.removeAttribute(D.name)}));return F.findNext(this||e,O)}}}}));O.addCommand("toggle",(function(e,O,F){if(F.matchToken("toggle")){F.matchAnyToken("the","my");if(F.currentToken().type==="STYLE_REF"){let O=F.consumeToken();var P=O.value.substr(1);var M=true;var D=i(e,F,P);if(F.matchToken("of")){F.pushFollow("with");try{var _=e.requireElement("expression",F)}finally{F.popFollow()}}else _=e.requireElement("implicitMeTarget",F)}else if(F.matchToken("between")){var G=true;var H=e.parseElement("classRef",F);F.requireToken("and");var j=e.requireElement("classRef",F)}else{H=e.parseElement("classRef",F);var U=null;if(H==null){U=e.parseElement("attributeRef",F);U==null&&e.raiseParseError(F,"Expected either a class reference or attribute expression")}else{var W=[H];while(H=e.parseElement("classRef",F))W.push(H)}}if(M!==true)if(F.matchToken("on"))_=e.requireElement("expression",F);else _=e.requireElement("implicitMeTarget",F);if(F.matchToken("for"))var B=e.requireElement("expression",F);else if(F.matchToken("until")){var V=e.requireElement("dotOrColonPath",F,"Expected event name");if(F.matchToken("from"))var z=e.requireElement("expression",F)}var Q={classRef:H,classRef2:j,classRefs:W,attributeRef:U,on:_,time:B,evt:V,from:z,toggle:function(e,F,P,H){O.nullCheck(e,_);M?O.implicitLoop(e,(function(e){D("toggle",e)})):G?O.implicitLoop(e,(function(e){if(e.classList.contains(F.className)){e.classList.remove(F.className);e.classList.add(P.className)}else{e.classList.add(F.className);e.classList.remove(P.className)}})):H?O.forEach(H,(function(F){O.implicitLoop(e,(function(e){e.classList.toggle(F.className)}))})):O.implicitLoop(e,(function(e){e.hasAttribute(U.name)?e.removeAttribute(U.name):e.setAttribute(U.name,U.value)}))},args:[_,B,V,z,H,j,W],op:function(e,F,P,M,D,_,G,H){if(P)return new Promise((function(M){Q.toggle(F,_,G,H);setTimeout((function(){Q.toggle(F,_,G,H);M(O.findNext(Q,e))}),P)}));if(M)return new Promise((function(P){var j=D||e.me;j.addEventListener(M,(function(){Q.toggle(F,_,G,H);P(O.findNext(Q,e))}),{once:true});Q.toggle(F,_,G,H)}));this.toggle(F,_,G,H);return O.findNext(Q,e)}};return Q}}));var F={display:function(e,P,M){if(M)P.style.display=M;else if(e==="toggle")getComputedStyle(P).display==="none"?F.display("show",P,M):F.display("hide",P,M);else if(e==="hide"){const e=O.runtime.getInternalData(P);e.originalDisplay==null&&(e.originalDisplay=P.style.display);P.style.display="none"}else{const e=O.runtime.getInternalData(P);e.originalDisplay&&e.originalDisplay!=="none"?P.style.display=e.originalDisplay:P.style.removeProperty("display")}},visibility:function(e,O,P){P?O.style.visibility=P:e==="toggle"?getComputedStyle(O).visibility==="hidden"?F.visibility("show",O,P):F.visibility("hide",O,P):O.style.visibility=e==="hide"?"hidden":"visible"},opacity:function(e,O,P){P?O.style.opacity=P:e==="toggle"?getComputedStyle(O).opacity==="0"?F.opacity("show",O,P):F.opacity("hide",O,P):O.style.opacity=e==="hide"?"0":"1"}};var n=function(e,O,F){var P;var M=F.currentToken();P=M.value==="when"||M.value==="with"||e.commandBoundary(M)?e.parseElement("implicitMeTarget",F):e.parseElement("expression",F);return P};var i=function(e,O,M){var D=P.defaultHideShowStrategy;var _=F;P.hideShowStrategies&&(_=Object.assign(_,P.hideShowStrategies));M=M||D||"display";var G=_[M];G==null&&e.raiseParseError(O,"Unknown show/hide strategy : "+M);return G};O.addCommand("hide",(function(O,F,P){if(P.matchToken("hide")){var M=n(O,F,P);var D=null;if(P.matchToken("with")){D=P.requireTokenType("IDENTIFIER","STYLE_REF").value;D.indexOf("*")===0&&(D=D.substr(1))}var _=i(O,P,D);return{target:M,args:[M],op:function(O,P){F.nullCheck(P,M);F.implicitLoop(P,(function(e){_("hide",e)}));return F.findNext(this||e,O)}}}}));O.addCommand("show",(function(O,F,P){if(P.matchToken("show")){var M=n(O,F,P);var D=null;if(P.matchToken("with")){D=P.requireTokenType("IDENTIFIER","STYLE_REF").value;D.indexOf("*")===0&&(D=D.substr(1))}var _=null;if(P.matchOpToken(":")){var G=P.consumeUntilWhitespace();P.matchTokenType("WHITESPACE");_=G.map((function(e){return e.value})).join("")}if(P.matchToken("when"))var H=O.requireElement("expression",P);var j=i(O,P,D);return{target:M,when:H,args:[M],op:function(O,P){F.nullCheck(P,M);F.implicitLoop(P,(function(e){if(H){O.result=e;let P=F.evaluateNoPromise(H,O);P?j("show",e,_):j("hide",e);O.result=null}else j("show",e,_)}));return F.findNext(this||e,O)}}}}));O.addCommand("take",(function(O,F,P){if(P.matchToken("take")){let j=null;let U=[];while(j=O.parseElement("classRef",P))U.push(j);var M=null;var D=null;let W=U.length>0;if(!W){M=O.parseElement("attributeRef",P);M==null&&O.raiseParseError(P,"Expected either a class reference or attribute expression");P.matchToken("with")&&(D=O.requireElement("expression",P))}if(P.matchToken("from"))var _=O.requireElement("expression",P);if(P.matchToken("for"))var G=O.requireElement("expression",P);else G=O.requireElement("implicitMeTarget",P);if(W){var H={classRefs:U,from:_,forElt:G,args:[U,_,G],op:function(O,P,M,D){F.nullCheck(D,G);F.implicitLoop(P,(function(e){var O=e.className;M?F.implicitLoop(M,(function(e){e.classList.remove(O)})):F.implicitLoop(e,(function(e){e.classList.remove(O)}));F.implicitLoop(D,(function(e){e.classList.add(O)}))}));return F.findNext(this||e,O)}};return H}H={attributeRef:M,from:_,forElt:G,args:[_,G,D],op:function(O,P,D,H){F.nullCheck(P,_);F.nullCheck(D,G);F.implicitLoop(P,(function(e){H?e.setAttribute(M.name,H):e.removeAttribute(M.name)}));F.implicitLoop(D,(function(e){e.setAttribute(M.name,M.value||"")}));return F.findNext(this||e,O)}};return H}}));function a(e,F,P,M){if(P!=null)var D=e.resolveSymbol(P,F);else D=F;if(D instanceof Element||D instanceof HTMLDocument){while(D.firstChild)D.removeChild(D.firstChild);D.append(O.runtime.convertValue(M,"Fragment"));e.processNode(D)}else{if(P==null)throw"Don't know how to put a value into "+typeof F;e.setSymbol(P,F,null,M)}}O.addCommand("put",(function(O,F,P){if(P.matchToken("put")){var M=O.requireElement("expression",P);var D=P.matchAnyToken("into","before","after");if(D==null&&P.matchToken("at")){P.matchToken("the");D=P.matchAnyToken("start","end");P.requireToken("of")}D==null&&O.raiseParseError(P,"Expected one of 'into', 'before', 'at start of', 'at end of', 'after'");var _=O.requireElement("expression",P);var G=D.value;var H=false;var j=false;var U=null;var W=null;if(_.type==="arrayIndex"&&G==="into"){H=true;W=_.prop;U=_.root}else if(_.prop&&_.root&&G==="into"){W=_.prop.value;U=_.root}else if(_.type==="symbol"&&G==="into"){j=true;W=_.name}else if(_.type==="attributeRef"&&G==="into"){var B=true;W=_.name;U=O.requireElement("implicitMeTarget",P)}else if(_.type==="styleRef"&&G==="into"){var V=true;W=_.name;U=O.requireElement("implicitMeTarget",P)}else if(_.attribute&&G==="into"){B=_.attribute.type==="attributeRef";V=_.attribute.type==="styleRef";W=_.attribute.name;U=_.root}else U=_;var z={target:_,operation:G,symbolWrite:j,value:M,args:[U,W,M],op:function(O,P,M,D){if(j)a(F,O,M,D);else{F.nullCheck(P,U);if(G==="into")B?F.implicitLoop(P,(function(e){e.setAttribute(M,D)})):V?F.implicitLoop(P,(function(e){e.style[M]=D})):H?P[M]=D:F.implicitLoop(P,(function(e){a(F,e,M,D)}));else{var _=G==="before"?Element.prototype.before:G==="after"?Element.prototype.after:G==="start"?Element.prototype.prepend:(G==="end",Element.prototype.append);F.implicitLoop(P,(function(e){_.call(e,D instanceof Node?D:F.convertValue(D,"Fragment"));e.parentElement?F.processNode(e.parentElement):F.processNode(e)}))}}return F.findNext(this||e,O)}};return z}}));function o(e,O,F){var P;if(F.matchToken("the")||F.matchToken("element")||F.matchToken("elements")||F.currentToken().type==="CLASS_REF"||F.currentToken().type==="ID_REF"||F.currentToken().op&&F.currentToken().value==="<"){e.possessivesDisabled=true;try{P=e.parseElement("expression",F)}finally{delete e.possessivesDisabled}F.matchOpToken("'")&&F.requireToken("s")}else if(F.currentToken().type==="IDENTIFIER"&&F.currentToken().value==="its"){var M=F.matchToken("its");P={type:"pseudopossessiveIts",token:M,name:M.value,evaluate:function(e){return O.resolveSymbol("it",e)}}}else{F.matchToken("my")||F.matchToken("me");P=e.parseElement("implicitMeTarget",F)}return P}O.addCommand("transition",(function(e,O,F){if(F.matchToken("transition")){var M=o(e,O,F);var D=[];var _=[];var G=[];var H=F.currentToken();while(!e.commandBoundary(H)&&H.value!=="over"&&H.value!=="using"){if(F.currentToken().type==="STYLE_REF"){let e=F.consumeToken();let O=e.value.substr(1);D.push({type:"styleRefValue",evaluate:function(){return O}})}else D.push(e.requireElement("stringLike",F));F.matchToken("from")?_.push(e.requireElement("expression",F)):_.push(null);F.requireToken("to");F.matchToken("initial")?G.push({type:"initial_literal",evaluate:function(){return"initial"}}):G.push(e.requireElement("expression",F));H=F.currentToken()}if(F.matchToken("over"))var j=e.requireElement("expression",F);else if(F.matchToken("using"))var U=e.requireElement("expression",F);var W={to:G,args:[M,D,_,G,U,j],op:function(e,F,D,_,G,H,j){O.nullCheck(F,M);var U=[];O.implicitLoop(F,(function(e){var F=new Promise((function(F,M){var U=e.style.transition;e.style.transition=j?"all "+j+"ms ease-in":H||P.defaultTransition;var W=O.getInternalData(e);var B=getComputedStyle(e);var V={};for(var z=0;z<B.length;z++){var Q=B[z];var Y=B[Q];V[Q]=Y}W.initialStyles||(W.initialStyles=V);for(z=0;z<D.length;z++){var $=D[z];var K=_[z];e.style[$]=K==="computed"||K==null?V[$]:K}var X=false;var J=false;e.addEventListener("transitionend",(function(){if(!J){e.style.transition=U;J=true;F()}}),{once:true});e.addEventListener("transitionstart",(function(){X=true}),{once:true});setTimeout((function(){if(!J&&!X){e.style.transition=U;J=true;F()}}),100);setTimeout((function(){for(var O=0;O<D.length;O++){var F=D[O];var P=G[O];if(P==="initial"){var M=W.initialStyles[F];e.style[F]=M}else e.style[F]=P}}),0)}));U.push(F)}));return Promise.all(U).then((function(){return O.findNext(W,e)}))}};return W}}));O.addCommand("measure",(function(O,F,P){if(P.matchToken("measure")){var M=o(O,F,P);var D=[];if(!O.commandBoundary(P.currentToken()))do{D.push(P.matchTokenType("IDENTIFIER").value)}while(P.matchOpToken(","));return{properties:D,args:[M],op:function(O,P){F.nullCheck(P,M);0 in P&&(P=P[0]);var _=P.getBoundingClientRect();var G={top:P.scrollTop,left:P.scrollLeft,topMax:P.scrollTopMax,leftMax:P.scrollLeftMax,height:P.scrollHeight,width:P.scrollWidth};O.result={x:_.x,y:_.y,left:_.left,top:_.top,right:_.right,bottom:_.bottom,width:_.width,height:_.height,bounds:_,scrollLeft:G.left,scrollTop:G.top,scrollLeftMax:G.leftMax,scrollTopMax:G.topMax,scrollWidth:G.width,scrollHeight:G.height,scroll:G};F.forEach(D,(function(e){if(!(e in O.result))throw"No such measurement as "+e;O.locals[e]=O.result[e]}));return F.findNext(this||e,O)}}}}));O.addLeafExpression("closestExpr",(function(O,F,P){if(P.matchToken("closest")){if(P.matchToken("parent"))var M=true;var D=null;if(P.currentToken().type==="ATTRIBUTE_REF"){var _=O.requireElement("attributeRefAccess",P,null);D="["+_.attribute.name+"]"}if(D==null){var G=O.requireElement("expression",P);G.css==null?O.raiseParseError(P,"Expected a CSS expression"):D=G.css}if(P.matchToken("to"))var H=O.parseElement("expression",P);else H=O.parseElement("implicitMeTarget",P);var j={type:"closestExpr",parentSearch:M,expr:G,css:D,to:H,args:[H],op:function(e,O){if(O==null)return null;{let e=[];F.implicitLoop(O,(function(O){M?e.push(O.parentElement?O.parentElement.closest(D):null):e.push(O.closest(D))}));return F.shouldAutoIterate(O)?e:e[0]}},evaluate:function(O){return F.unifiedEval(this||e,O)}};if(_){_.root=j;_.args=[j];return _}return j}}));O.addCommand("go",(function(e,O,F){if(F.matchToken("go")){if(F.matchToken("back"))var P=true;else{F.matchToken("to");if(F.matchToken("url")){var M=e.requireElement("stringLike",F);var D=true;if(F.matchToken("in")){F.requireToken("new");F.requireToken("window");var _=true}}else{F.matchToken("the");var G=F.matchAnyToken("top","middle","bottom");var H=F.matchAnyToken("left","center","right");(G||H)&&F.requireToken("of");M=e.requireElement("unaryExpression",F);var j=F.matchAnyOpToken("+","-");if(j){F.pushFollow("px");try{var U=e.requireElement("expression",F)}finally{F.popFollow()}}F.matchToken("px");var W=F.matchAnyToken("smoothly","instantly");var B={block:"start",inline:"nearest"};G&&(G.value==="top"?B.block="start":G.value==="bottom"?B.block="end":G.value==="middle"&&(B.block="center"));H&&(H.value==="left"?B.inline="start":H.value==="center"?B.inline="center":H.value==="right"&&(B.inline="end"));W&&(W.value==="smoothly"?B.behavior="smooth":W.value==="instantly"&&(B.behavior="instant"))}}var V={target:M,args:[M,U],op:function(e,F,M){P?window.history.back():D?F&&(_?window.open(F):window.location.href=F):O.implicitLoop(F,(function(e){e===window&&(e=document.body);if(j){let O=e.getBoundingClientRect();let F=document.createElement("div");let P=j.value==="+"?M:M*-1;let D=B.inline=="start"||B.inline=="end"?P:0;let _=B.block=="start"||B.block=="end"?P:0;F.style.position="absolute";F.style.top=O.top+window.scrollY+_+"px";F.style.left=O.left+window.scrollX+D+"px";F.style.height=O.height+"px";F.style.width=O.width+"px";F.style.zIndex=""+Number.MIN_SAFE_INTEGER;F.style.opacity="0";document.body.appendChild(F);setTimeout((function(){document.body.removeChild(F)}),100);e=F}e.scrollIntoView(B)}));return O.findNext(V,e)}};return V}}));P.conversions.dynamicResolvers.push((function(e,F){if(e==="Values"||e.indexOf("Values:")===0){var P=e.split(":")[1];var M={};var D=O.runtime.implicitLoop.bind(O.runtime);D(F,(function(e){var O=s(e);if(O===void 0){if(e.querySelectorAll!=void 0){var F=e.querySelectorAll("input,select,textarea");F.forEach(o)}}else M[O.name]=O.value}));if(P){if(P==="JSON")return JSON.stringify(M);if(P==="Form")return new URLSearchParams(M).toString();throw"Unknown conversion: "+P}return M}function o(e){var O=s(e);O!=void 0&&(M[O.name]!=void 0?Array.isArray(M[O.name])&&Array.isArray(O.value)&&(M[O.name]=[].concat(M[O.name],O.value)):M[O.name]=O.value)}function s(e){try{var O={name:e.name,value:e.value};if(O.name==void 0||O.value==void 0)return;if(e.type=="radio"&&e.checked==false)return;e.type=="checkbox"&&(e.checked==false?O.value=void 0:typeof O.value==="string"&&(O.value=[O.value]));if(e.type=="select-multiple"){var F=e.querySelectorAll("option[selected]");O.value=[];for(var P=0;P<F.length;P++)O.value.push(F[P].value)}return O}catch(e){return}}}));P.conversions.HTML=function(e){var t=function(e){if(e instanceof Array)return e.map((function(e){return t(e)})).join("");if(e instanceof HTMLElement)return e.outerHTML;if(e instanceof NodeList){var O="";for(var F=0;F<e.length;F++){var P=e[F];P instanceof HTMLElement&&(O+=P.outerHTML)}return O}return e.toString?e.toString():""};return t(e)};P.conversions.Fragment=function(e){var F=document.createDocumentFragment();O.runtime.implicitLoop(e,(function(e){if(e instanceof Node)F.append(e);else{var O=document.createElement("template");O.innerHTML=e;F.append(O.content)}}));return F}}const _=new o,G=_.lexer,H=_.parser;function b(e,O){return _.evaluate(e,O)}function w(){var e=Array.from(O.document.querySelectorAll("script[type='text/hyperscript'][src]"));Promise.all(e.map((function(e){return fetch(e.src).then((function(e){return e.text()}))}))).then((e=>e.forEach((e=>j(e))))).then((()=>n((function(){a();_.processNode(document.documentElement);document.dispatchEvent(new Event("hyperscript:ready"));O.document.addEventListener("htmx:load",(function(e){_.processNode(e.detail.elt)}))}))));function n(e){document.readyState!=="loading"?setTimeout(e):document.addEventListener("DOMContentLoaded",e)}function i(){var e=document.querySelector('meta[name="htmx-config"]');return e?v(e.content):null}function a(){var e=i();e&&Object.assign(P,e)}}const j=Object.assign(b,{config:P,use(e){e(j)},internals:{lexer:G,parser:H,runtime:_,Lexer:n,Tokens:i,Parser:a,Runtime:o},ElementCollection:m,addFeature:H.addFeature.bind(H),addCommand:H.addCommand.bind(H),addLeafExpression:H.addLeafExpression.bind(H),addIndirectExpression:H.addIndirectExpression.bind(H),evaluate:_.evaluate.bind(_),parse:_.parse.bind(_),processNode:_.processNode.bind(_),version:"0.9.14",browserInit:w});return j}));var F=O;export{F as default};

